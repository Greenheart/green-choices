var Dt=Object.defineProperty;var Lt=(n,t,s)=>t in n?Dt(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s;var V=(n,t,s)=>(Lt(n,typeof t!="symbol"?t+"":t,s),s);import{S as W,i as N,s as z,k as x,l as S,m as M,h,n as g,p as k,b as D,E as _,B as E,f as P,g as Z,d as tt,t as L,P as et,q as O,a as A,w as T,r as F,c as j,x as X,y as B,u as H,z as Y,Q as rt,R as $t,C as At,T as jt,U as Q,F as Ct,G as Vt,H as Ot,V as kt,I as Et,W as xt,e as R,D as Ft,o as St,X as Rt,Y as at,Z as Wt}from"../../../chunks/index-f00670b2.js";import{w as Mt}from"../../../chunks/index-cde342c9.js";const Nt="/scenarios/default.json";var It=(n=>(n[n.Left=-1]="Left",n[n.Right=1]="Right",n))(It||{});const Pt=250,ot=100;function zt(n,t){return t.some(s=>Ht(n,s))}function Ht(n,{vars:t={}}){return Object.entries(t).every(([e,r])=>{if(Array.isArray(r)){const[a,o]=r;return n.vars[e]>=a&&n.vars[e]<=o}else return n.vars[e]===r})}class Qt{constructor(t,s,e,r={}){V(this,"_cards");V(this,"_random");V(this,"_tickModifiers");V(this,"_stats");V(this,"_initialParams");const{random:a=Math.random,tickModifiers:o=[]}=r;this._cards=t,this._random=a,this._tickModifiers=o,this._initialParams=e,this._stats=s}get stats(){return this._stats}get initialState(){return this.applyAction({params:this._initialParams},t=>t)}get preloadAssets(){return this._cards.map(t=>t.image)}applyAction(t,s){const e=this._applyModifiers({...t,card:void 0},[s,...this._tickModifiers]);return e.card?e:{...e,card:this._selectWeightedRandomFrom(this._getAvailableCards(e))}}_applyModifiers(t,s){return s.reduce((e,r)=>r(e),t)}_getAvailableCards(t){const s=this._cards.filter(a=>a.match(t)),e={};for(const a of s)e[a.priority]=e[a.priority]?e[a.priority].concat(a):[a];let r=Math.min(...Object.keys(e).map(a=>parseInt(a,10)));return e[r]}_selectWeightedRandomFrom(t,s=e=>e.weight){const{selectionList:e,count:r}=t.reduce((i,l)=>(i.count+=s(l),i.selectionList.push(i.count),i),{count:0,selectionList:[]}),a=this._random()*r,o=e.findIndex((i,l,c)=>{const u=l>0?c[l-1]:0;return a>=u&&a<=i});return t[o]}}const Tt=n=>{var t;return{...n,params:{vars:{...n.params.vars,rounds:((t=n.params.vars.rounds)!=null?t:0)+1}}}};function Xt(n,t){return s=>{var e;return{...s,params:{vars:{...s.params.vars,[n]:(((e=s.params.vars[n])!=null?e:0)+1)%t}}}}}function q(n,t,s,e){return r=>{const a=r.params,o=t.map(l=>{var c;return(c=a.vars[l])!=null?c:0}),i=e?o.reduce((l,c)=>s(l,c),e):o.reduce((l,c)=>s(l,c));return{...r,params:{vars:{...r.params.vars,[n]:i}}}}}function Bt(n){return t=>{const s=t.params,e=n===void 0?s.vars:n.reduce((r,a)=>(r[a]=s.vars[a],r),{});return Object.keys(e).length>0&&console.table(e),t}}function Yt(n){return t=>({...t,params:{vars:{...t.params.vars,...n.reduce((s,e)=>{const r=t.params.vars[e.id];return r!==void 0&&(s[e.id]=Math.max(e.min,Math.min(e.max,r))),s},{})}}})}function Gt(n){return n.map(t=>{switch(t.type){case"round":return Tt;case"cycle":return Xt(t.id,t.length);case"min":return q(t.targetId,t.sourceIds,(s,e)=>Math.min(s,e));case"max":return q(t.targetId,t.sourceIds,(s,e)=>Math.max(s,e));case"sum":return q(t.targetId,t.sourceIds,(s,e)=>s+e,0);case"debug":return Bt(t.stateIds);default:throw new Error("Missing modifier type: "+t.type)}})}function Ut(n,t=Math.random){const s={vars:n.defaultState.state},e=n.cards.reduce((l,c)=>(l[c.id]=c,l),{}),r=Zt(e,s);console.log("Loaded cards:",r);const a=Jt(n.stats),o=qt(n.stats),i=Gt(n.worldStateModifiers);return new Qt(Object.values(r),o,s,{tickModifiers:[a,...i],random:t})}function qt(n){return n.map(t=>({...t,getValue:({params:s})=>{var e;return(e=s.vars[t.id])!=null?e:0}}))}function Jt(n){return Yt(n)}function Kt(n,t){const s=("isAvailableWhen"in n?n.isAvailableWhen:[]).map(te);return{id:n.id,image:n.image,title:n.title,text:n.text,location:n.location,match:e=>zt(e.params,s),weight:n.weight,actions:{left:lt(n.actions.left,t,"No"),right:lt(n.actions.right,t,"Yes")},priority:n.priority}}function Zt(n,t){const s=Object.keys(n).reduce((e,r)=>{const a=n[r];return e[r]=Kt(a,t),e},{});for(const e in s){const r=n[e],a=s[e];a.actions.left.modifier=it(r.actions.left,s,a.actions.left.modifier),a.actions.right.modifier=it(r.actions.right,s,a.actions.right.modifier)}return s}function it(n,t,s){const e=n.next?t[n.next]:void 0;return e?r=>({...s(r),card:e}):s}function lt(n,t,s){var e;return{description:(e=n.description)!=null?e:s,modifier:r=>ee(r,n.modifiers,t),next:n.next}}function te(n){return{vars:n.state}}function ee(n,t,s){return{...n,params:{vars:t.reduce((e,r)=>se(e,r,s.vars),n.params.vars)}}}function se(n,t,s){const e=t.type==="replace"?Object.assign({},s):Object.assign({},n),r=t.state||{};return Object.entries(r).reduce((o,[i,l])=>{const c=t.type==="set"||t.type==="replace"?l:l+(o[i]||0);return o[i]=c,o},e)}async function ne(n){const t=n.match(/^local:\/\/(.*)/);if(t){const e="game_world:"+t[1],r={stats:[],cards:[],defaultState:{state:{}},worldStateModifiers:[]},a=localStorage.getItem(e),o=a?JSON.parse(a):null;if(!o)throw new Error("Could not load data from local storage: "+e);return Object.assign(r,o)}return null}async function re(n){return await ne(n)||await ae(n)}async function ae(n){return console.log("Fetching path: ",n),await(await window.fetch(n)).json()}function oe(n){let t,s;return{c(){t=x("div"),s=x("div"),this.h()},l(e){t=S(e,"DIV",{class:!0});var r=M(t);s=S(r,"DIV",{class:!0,style:!0}),M(s).forEach(h),r.forEach(h),this.h()},h(){g(s,"class","relative h-full bg-white"),k(s,"width",n[0]+"%"),g(t,"class","w-8 h-1 2xs:w-10 2xs:h-1.5 xs:w-12 xs:h-2 bg-gray-800 shadow-lg")},m(e,r){D(e,t,r),_(t,s)},p(e,[r]){r&1&&k(s,"width",e[0]+"%")},i:E,o:E,d(e){e&&h(t)}}}function ie(n,t,s){let{value:e}=t;return n.$$set=r=>{"value"in r&&s(0,e=r.value)},[e]}class le extends W{constructor(t){super(),N(this,t,ie,oe,z,{value:0})}}function ct(n,t,s){const e=n.slice();return e[1]=t[s],e}function ut(n){let t,s,e=n[1].name.slice(0,2)+"",r,a,o,i,l;return o=new le({props:{value:n[1].value}}),{c(){t=x("div"),s=x("div"),r=O(e),a=A(),T(o.$$.fragment),i=A(),this.h()},l(c){t=S(c,"DIV",{class:!0});var u=M(t);s=S(u,"DIV",{class:!0});var f=M(s);r=F(f,e),f.forEach(h),a=j(u),X(o.$$.fragment,u),i=j(u),u.forEach(h),this.h()},h(){g(s,"class","w-8 h-8 2xs:w-10 2xs:h-10 xs:w-12 xs:h-12 rounded-full bg-white grid place-items-center shadow-lg mb-2 xs:mb-3 text-black text-sm"),g(t,"class","flex justify-between items-center flex-col")},m(c,u){D(c,t,u),_(t,s),_(s,r),_(t,a),B(o,t,null),_(t,i),l=!0},p(c,u){(!l||u&1)&&e!==(e=c[1].name.slice(0,2)+"")&&H(r,e);const f={};u&1&&(f.value=c[1].value),o.$set(f)},i(c){l||(P(o.$$.fragment,c),l=!0)},o(c){L(o.$$.fragment,c),l=!1},d(c){c&&h(t),Y(o)}}}function ce(n){let t,s,e=n[0],r=[];for(let o=0;o<e.length;o+=1)r[o]=ut(ct(n,e,o));const a=o=>L(r[o],1,1,()=>{r[o]=null});return{c(){t=x("header");for(let o=0;o<r.length;o+=1)r[o].c();this.h()},l(o){t=S(o,"HEADER",{class:!0});var i=M(t);for(let l=0;l<r.length;l+=1)r[l].l(i);i.forEach(h),this.h()},h(){g(t,"class","flex bg-green-700 xs:space-x-10 justify-around xs:justify-center items-center p-2 2xs:p-4 shadow-lg")},m(o,i){D(o,t,i);for(let l=0;l<r.length;l+=1)r[l].m(t,null);s=!0},p(o,[i]){if(i&1){e=o[0];let l;for(l=0;l<e.length;l+=1){const c=ct(o,e,l);r[l]?(r[l].p(c,i),P(r[l],1)):(r[l]=ut(c),r[l].c(),P(r[l],1),r[l].m(t,null))}for(Z(),l=e.length;l<r.length;l+=1)a(l);tt()}},i(o){if(!s){for(let i=0;i<e.length;i+=1)P(r[i]);s=!0}},o(o){r=r.filter(Boolean);for(let i=0;i<r.length;i+=1)L(r[i]);s=!1},d(o){o&&h(t),et(r,o)}}}function ue(n,t,s){let{stats:e}=t;return n.$$set=r=>{"stats"in r&&s(0,e=r.stats)},[e]}class fe extends W{constructor(t){super(),N(this,t,ue,ce,z,{stats:0})}}function de(n){let t,s,e,r;function a(c,u,f){c==="panstart"&&(e=u,r=f);const d={x:u,y:f,dx:u-t,dy:f-s,startY:r,startX:e,totalDeltaX:u-e,totalDeltaY:f-r};return t=u,s=f,new CustomEvent(c,{detail:d})}function o(c){n.dispatchEvent(a("panstart",c.clientX,c.clientY)),window.addEventListener("pointermove",i),window.addEventListener("pointerup",l)}function i(c){n.dispatchEvent(a("panmove",c.clientX,c.clientY))}function l(c){n.dispatchEvent(a("panend",c.clientX,c.clientY)),window.removeEventListener("pointermove",i),window.removeEventListener("pointerup",l)}return n.addEventListener("pointerdown",o),{destroy(){n.removeEventListener("pointerdown",o)}}}function ft(n){return Object.prototype.toString.call(n)==="[object Date]"}function K(n,t,s,e){if(typeof s=="number"||ft(s)){const r=e-s,a=(s-t)/(n.dt||1/60),o=n.opts.stiffness*r,i=n.opts.damping*a,l=(o-i)*n.inv_mass,c=(a+l)*n.dt;return Math.abs(c)<n.opts.precision&&Math.abs(r)<n.opts.precision?e:(n.settled=!1,ft(s)?new Date(s.getTime()+c):s+c)}else{if(Array.isArray(s))return s.map((r,a)=>K(n,t[a],s[a],e[a]));if(typeof s=="object"){const r={};for(const a in s)r[a]=K(n,t[a],s[a],e[a]);return r}else throw new Error(`Cannot spring ${typeof s} values`)}}function he(n,t={}){const s=Mt(n),{stiffness:e=.15,damping:r=.8,precision:a=.01}=t;let o,i,l,c=n,u=n,f=1,d=0,v=!1;function y(I,m={}){u=I;const $=l={};return n==null||m.hard||p.stiffness>=1&&p.damping>=1?(v=!0,o=rt(),c=I,s.set(n=u),Promise.resolve()):(m.soft&&(d=1/((m.soft===!0?.5:+m.soft)*60),f=0),i||(o=rt(),v=!1,i=$t(w=>{if(v)return v=!1,i=null,!1;f=Math.min(f+d,1);const b={inv_mass:f,opts:p,settled:!0,dt:(w-o)*60/1e3},C=K(b,c,n,u);return o=w,c=n,s.set(n=C),b.settled&&(i=null),!b.settled})),new Promise(w=>{i.promise.then(()=>{$===l&&w()})}))}const p={set:y,update:(I,m)=>y(I(u,n),m),subscribe:s.subscribe,stiffness:e,damping:r,precision:a};return p}function dt(n,t,s){const e=n.slice();return e[14]=t[s],e[16]=s,e}function ht(n){let t,s,e=gt,r=[];for(let a=0;a<e.length;a+=1)r[a]=mt(dt(n,e,a));return{c(){t=x("div");for(let a=0;a<r.length;a+=1)r[a].c();this.h()},l(a){t=S(a,"DIV",{class:!0,style:!0});var o=M(t);for(let i=0;i<r.length;i+=1)r[i].l(o);o.forEach(h),this.h()},h(){g(t,"class",s="absolute overflow-hidden "+n[1]),k(t,"transition","border-width 0.2s"),k(t,"border-color","#fff"),k(t,"border-style","solid"),k(t,"border-width",pe)},m(a,o){D(a,t,o);for(let i=0;i<r.length;i+=1)r[i].m(t,null)},p(a,o){if(o&81){e=gt;let i;for(i=0;i<e.length;i+=1){const l=dt(a,e,i);r[i]?r[i].p(l,o):(r[i]=mt(l),r[i].c(),r[i].m(t,null))}for(;i<r.length;i+=1)r[i].d(1);r.length=e.length}o&2&&s!==(s="absolute overflow-hidden "+a[1])&&g(t,"class",s)},d(a){a&&h(t),et(r,a)}}}function mt(n){let t,s,e=n[0][n[14]].description+"",r,a;return{c(){t=x("div"),s=x("span"),r=O(e),a=A(),this.h()},l(o){t=S(o,"DIV",{class:!0,style:!0});var i=M(t);s=S(i,"SPAN",{class:!0,style:!0});var l=M(s);r=F(l,e),l.forEach(h),a=j(i),i.forEach(h),this.h()},h(){g(s,"class","relative block bg-black bg-opacity-80 text-md w-[100%] px-[30%] py-[5%] pt-[30%]"),k(s,"text-shadow","0 2px 4px #000"),k(s,"text-align",n[14]==="left"?"right":"left"),k(s,"transition","transform 0.2s"),k(s,"transform","translate3d(0, "+(n[14]===n[4]?"0":"-10px")+", 0)"),g(t,"class","absolute top-[-50%] left-[50%] w-[200%]"),k(t,"transform","translate3d(-50%, 0, 0) rotate3d(0, 0, 1, "+n[6].x*-.05+"deg)"),k(t,"transition","opacity 0.2s"),k(t,"opacity",n[14]===n[4]?1:0),k(t,"overflow","hidden")},m(o,i){D(o,t,i),_(t,s),_(s,r),_(t,a)},p(o,i){i&1&&e!==(e=o[0][o[14]].description+"")&&H(r,e),i&16&&k(s,"transform","translate3d(0, "+(o[14]===o[4]?"0":"-10px")+", 0)"),i&64&&k(t,"transform","translate3d(-50%, 0, 0) rotate3d(0, 0, 1, "+o[6].x*-.05+"deg)"),i&16&&k(t,"opacity",o[14]===o[4]?1:0)},d(o){o&&h(t)}}}function me(n){let t,s,e,r,a,o,i=n[3]&&ht(n);const l=n[12].default,c=At(l,n,n[11],null);return{c(){t=x("div"),i&&i.c(),s=A(),c&&c.c(),this.h()},l(u){t=S(u,"DIV",{class:!0,style:!0});var f=M(t);i&&i.l(f),s=j(f),c&&c.l(f),f.forEach(h),this.h()},h(){g(t,"class","shadow-md rounded-md cursor-move select-none relative"),g(t,"style",e="transform: translate3d("+n[6].x+"px, "+n[6].y+"px, 0) rotate3d(0, 0, 1, "+n[6].x*.05+"deg); "+(n[2]?pt:""))},m(u,f){D(u,t,f),i&&i.m(t,null),_(t,s),c&&c.m(t,null),r=!0,a||(o=[jt(de.call(null,t)),Q(t,"panstart",n[7]),Q(t,"panmove",n[8]),Q(t,"panend",n[9])],a=!0)},p(u,[f]){u[3]?i?i.p(u,f):(i=ht(u),i.c(),i.m(t,s)):i&&(i.d(1),i=null),c&&c.p&&(!r||f&2048)&&Ct(c,l,u,u[11],r?Ot(l,u[11],f,null):Vt(u[11]),null),(!r||f&68&&e!==(e="transform: translate3d("+u[6].x+"px, "+u[6].y+"px, 0) rotate3d(0, 0, 1, "+u[6].x*.05+"deg); "+(u[2]?pt:"")))&&g(t,"style",e)},i(u){r||(P(c,u),r=!0)},o(u){L(c,u),r=!1},d(u){u&&h(t),i&&i.d(),c&&c.d(u),a=!1,kt(o)}}}const pt=`transition: transform ${Pt}ms ease-out`,gt=["left","right"];let pe="";function ge(n,t,s){let e,{$$slots:r={},$$scope:a}=t,{onSwipe:o}=t,{actions:i}=t,{imageSize:l}=t,c=!1,u,f;const d=he({x:0,y:0},{stiffness:.2,damping:.4});Et(n,d,m=>s(6,e=m));function v(){s(5,d.stiffness=s(5,d.damping=1,d),d)}function y(m){d.update(()=>({x:e.x+m.detail.dx,y:e.y+m.detail.dy})),s(3,u=Math.sign(m.detail.totalDeltaX)),Math.abs(m.detail.totalDeltaX)>.25*ot?s(4,f=u>0?"left":"right"):s(4,f=void 0)}function p(m){return new Promise(function($){setTimeout(function(){o(m),$()},Pt)})}async function I(m){s(4,f=void 0),Math.abs(m.detail.totalDeltaX)>ot&&u!==void 0?(s(2,c=!0),xt(d,e.x=m.target.clientWidth+Math.max(window.innerHeight,window.innerWidth)*u,e),await p(u),s(2,c=!1)):(s(5,d.stiffness=.2,d),s(5,d.damping=.8,d)),s(3,u=void 0),d.set({x:0,y:0})}return n.$$set=m=>{"onSwipe"in m&&s(10,o=m.onSwipe),"actions"in m&&s(0,i=m.actions),"imageSize"in m&&s(1,l=m.imageSize),"$$scope"in m&&s(11,a=m.$$scope)},[i,l,c,u,f,d,e,v,y,I,o,a,r]}class _e extends W{constructor(t){super(),N(this,t,ge,me,z,{onSwipe:10,actions:0,imageSize:1})}}function ve(n){let t;return{c(){t=x("div"),this.h()},l(s){t=S(s,"DIV",{style:!0,class:!0}),M(t).forEach(h),this.h()},h(){k(t,"background-image","url("+n[0].image+")"),g(t,"class","bg-no-repeat bg-center "+U+" z-10 bg-cover svelte-1lu8ytm")},m(s,e){D(s,t,e)},p(s,e){e&1&&k(t,"background-image","url("+s[0].image+")")},d(s){s&&h(t)}}}function we(n){let t,s,e=n[0].text+"",r,a,o,i,l,c,u,f,d=n[0].title+"",v,y,p,I=n[0].location+"",m,$;return c=new _e({props:{onSwipe:n[1],actions:n[0].actions,imageSize:U,$$slots:{default:[ve]},$$scope:{ctx:n}}}),{c(){t=x("div"),s=x("p"),r=O(e),a=A(),o=x("div"),i=x("div"),l=A(),T(c.$$.fragment),u=A(),f=x("h2"),v=O(d),y=A(),p=x("p"),m=O(I),this.h()},l(w){t=S(w,"DIV",{class:!0});var b=M(t);s=S(b,"P",{class:!0});var C=M(s);r=F(C,e),C.forEach(h),a=j(b),o=S(b,"DIV",{class:!0});var G=M(o);i=S(G,"DIV",{class:!0}),M(i).forEach(h),l=j(G),X(c.$$.fragment,G),G.forEach(h),u=j(b),f=S(b,"H2",{class:!0});var st=M(f);v=F(st,d),st.forEach(h),y=j(b),p=S(b,"P",{class:!0});var nt=M(p);m=F(nt,I),nt.forEach(h),b.forEach(h),this.h()},h(){g(s,"class","text-center xs:py-4 h-36 2xs:h-44 xs:h-56 flex place-items-center px-4 xs:px-8"),g(i,"class","absolute z-0 "+U+" top-0 left-0 bg-gray-900 svelte-1lu8ytm"),g(o,"class",U+" relative svelte-1lu8ytm"),g(f,"class","mt-2 xs:mt-4"),g(p,"class","text-gray-300 mb-2 xs:mb-4"),g(t,"class","flex flex-col items-center justify-center text-white 2xs:text-lg xs:text-xl font-light max-w-prose m-auto card svelte-1lu8ytm")},m(w,b){D(w,t,b),_(t,s),_(s,r),_(t,a),_(t,o),_(o,i),_(o,l),B(c,o,null),_(t,u),_(t,f),_(f,v),_(t,y),_(t,p),_(p,m),$=!0},p(w,[b]){(!$||b&1)&&e!==(e=w[0].text+"")&&H(r,e);const C={};b&2&&(C.onSwipe=w[1]),b&1&&(C.actions=w[0].actions),b&5&&(C.$$scope={dirty:b,ctx:w}),c.$set(C),(!$||b&1)&&d!==(d=w[0].title+"")&&H(v,d),(!$||b&1)&&I!==(I=w[0].location+"")&&H(m,I)},i(w){$||(P(c.$$.fragment,w),$=!0)},o(w){L(c.$$.fragment,w),$=!1},d(w){w&&h(t),Y(c)}}}const U="w-[60vmin] h-[60vmin] 2xs:w-[85vmin] 2xs:h-[85vmin] max-w-[400px] max-h-[400px] rounded-lg";function be(n,t,s){let{card:e}=t,{onSwipe:r}=t;return n.$$set=a=>{"card"in a&&s(0,e=a.card),"onSwipe"in a&&s(1,r=a.onSwipe)},[e,r]}class ye extends W{constructor(t){super(),N(this,t,be,we,z,{card:0,onSwipe:1})}}const{document:J}=Rt;function _t(n,t,s){const e=n.slice();return e[5]=t[s],e}function vt(n){let t,s;return{c(){t=x("link"),this.h()},l(e){t=S(e,"LINK",{rel:!0,as:!0,href:!0}),this.h()},h(){g(t,"rel","preload"),g(t,"as","image"),g(t,"href",s=n[5])},m(e,r){D(e,t,r)},p(e,r){r&1&&s!==(s=e[5])&&g(t,"href",s)},d(e){e&&h(t)}}}function wt(n){let t,s;return t=new ye({props:{card:n[1].card,onSwipe:n[4]}}),{c(){T(t.$$.fragment)},l(e){X(t.$$.fragment,e)},m(e,r){B(t,e,r),s=!0},p(e,r){const a={};r&2&&(a.card=e[1].card),t.$set(a)},i(e){s||(P(t.$$.fragment,e),s=!0)},o(e){L(t.$$.fragment,e),s=!1},d(e){Y(t,e)}}}function ke(n){let t,s,e,r,a,o,i,l,c=n[0].preloadAssets,u=[];for(let d=0;d<c.length;d+=1)u[d]=vt(_t(n,c,d));r=new fe({props:{stats:n[2]}});let f=n[1].card&&wt(n);return{c(){for(let d=0;d<u.length;d+=1)u[d].c();t=R(),s=A(),e=x("main"),T(r.$$.fragment),a=A(),f&&f.c(),this.h()},l(d){const v=Ft("svelte-i83wkk",J.head);for(let p=0;p<u.length;p+=1)u[p].l(v);t=R(),v.forEach(h),s=j(d),e=S(d,"MAIN",{class:!0});var y=M(e);X(r.$$.fragment,y),a=j(y),f&&f.l(y),y.forEach(h),this.h()},h(){g(e,"class","text-white")},m(d,v){for(let y=0;y<u.length;y+=1)u[y].m(J.head,null);_(J.head,t),D(d,s,v),D(d,e,v),B(r,e,null),_(e,a),f&&f.m(e,null),o=!0,i||(l=[Q(e,"dragstart",bt),Q(e,"select",bt)],i=!0)},p(d,[v]){if(v&1){c=d[0].preloadAssets;let p;for(p=0;p<c.length;p+=1){const I=_t(d,c,p);u[p]?u[p].p(I,v):(u[p]=vt(I),u[p].c(),u[p].m(t.parentNode,t))}for(;p<u.length;p+=1)u[p].d(1);u.length=c.length}const y={};v&4&&(y.stats=d[2]),r.$set(y),d[1].card?f?(f.p(d,v),v&2&&P(f,1)):(f=wt(d),f.c(),P(f,1),f.m(e,null)):f&&(Z(),L(f,1,1,()=>{f=null}),tt())},i(d){o||(P(r.$$.fragment,d),P(f),o=!0)},o(d){L(r.$$.fragment,d),L(f),o=!1},d(d){et(u,d),h(t),d&&h(s),d&&h(e),Y(r),f&&f.d(),i=!1,kt(l)}}}function bt(n){return n.preventDefault(),n.stopPropagation(),!1}function Ee(n,t,s){let e,{game:r}=t;const a=Mt(r.initialState);Et(n,a,l=>s(1,e=l));let o;function i(l){const c=l===It.Left?e.card.actions.left.modifier:e.card.actions.right.modifier;xt(a,e=r.applyAction(e,c),e)}return St(()=>(document.documentElement.classList.add("in-game"),()=>document.documentElement.classList.remove("in-game"))),n.$$set=l=>{"game"in l&&s(0,r=l.game)},n.$$.update=()=>{n.$$.dirty&3&&s(2,o=r.stats.map(l=>Object.assign({},l,{value:l.getValue(e)})))},[r,e,o,a,i]}class xe extends W{constructor(t){super(),N(this,t,Ee,ke,z,{game:0})}}function Se(n){let t,s;return{c(){t=x("p"),s=O("Loading..."),this.h()},l(e){t=S(e,"P",{class:!0});var r=M(t);s=F(r,"Loading..."),r.forEach(h),this.h()},h(){g(t,"class","grid place-items-center text-white font-black text-2xl tracking-widest h-[60vh]")},m(e,r){D(e,t,r),_(t,s)},p:E,i:E,o:E,d(e){e&&h(t)}}}function Me(n){let t,s,e,r={ctx:n,current:null,token:null,hasCatch:!1,pending:De,then:Pe,catch:Ie,value:1,blocks:[,,,]};return at(s=yt(n[0]),r),{c(){t=R(),r.block.c()},l(a){t=R(),r.block.l(a)},m(a,o){D(a,t,o),r.block.m(a,r.anchor=o),r.mount=()=>t.parentNode,r.anchor=t,e=!0},p(a,o){n=a,r.ctx=n,o&1&&s!==(s=yt(n[0]))&&at(s,r)||Wt(r,n,o)},i(a){e||(P(r.block),e=!0)},o(a){for(let o=0;o<3;o+=1){const i=r.blocks[o];L(i)}e=!1},d(a){a&&h(t),r.block.d(a),r.token=null,r=null}}}function Ie(n){return{c:E,l:E,m:E,p:E,i:E,o:E,d:E}}function Pe(n){let t,s;return t=new xe({props:{game:n[1]}}),{c(){T(t.$$.fragment)},l(e){X(t.$$.fragment,e)},m(e,r){B(t,e,r),s=!0},p(e,r){const a={};r&1&&(a.game=e[1]),t.$set(a)},i(e){s||(P(t.$$.fragment,e),s=!0)},o(e){L(t.$$.fragment,e),s=!1},d(e){Y(t,e)}}}function De(n){return{c:E,l:E,m:E,p:E,i:E,o:E,d:E}}function Le(n){let t,s,e,r;const a=[Me,Se],o=[];function i(l,c){return l[0]?0:1}return t=i(n),s=o[t]=a[t](n),{c(){s.c(),e=R()},l(l){s.l(l),e=R()},m(l,c){o[t].m(l,c),D(l,e,c),r=!0},p(l,[c]){let u=t;t=i(l),t===u?o[t].p(l,c):(Z(),L(o[u],1,1,()=>{o[u]=null}),tt(),s=o[t],s?s.p(l,c):(s=o[t]=a[t](l),s.c()),P(s,1),s.m(e.parentNode,e))},i(l){r||(P(s),r=!0)},o(l){L(s),r=!1},d(l){o[t].d(l),l&&h(e)}}}async function yt(n){const t=await re(n);if(t)return Ut(t);throw new Error(`Could not load scenario data: ${n}`)}function $e(n,t,s){let e;return St(()=>{var i;const r=new URLSearchParams(window.location.search),a=r.get("dev"),o=a?`//${window.location.host}/dev-only/${a}.json`:void 0;s(0,e=o||((i=r.get("path"))!=null?i:Nt))}),[e]}class Ve extends W{constructor(t){super(),N(this,t,$e,Le,z,{})}}export{Ve as default};
