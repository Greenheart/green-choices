var Ue=Object.defineProperty;var Xe=(n,e,t)=>e in n?Ue(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var H=(n,e,t)=>(Xe(n,typeof e!="symbol"?e+"":e,t),t);import{i as Ge,j as Ye,k as ee,l as Je,r as de,s as z,n as w,c as Ze,m as Ke,u as et,g as tt,d as st,e as se,p as G,q as nt,v as _e,w as rt,x as he,t as at,o as qe,f as ue,h as ge,y as ve}from"../chunks/scheduler.e0e30f49.js";import{p as F,t as I,b as N,d as y,S as R,i as W,g as E,h as S,j as $,f as _,k as b,l as M,a as D,y as k,B as be,C as it,s as x,c as C,D as J,E as He,m as ne,n as re,o as ae,r as B,u as Q,v as U,w as X,F as me,e as O,x as lt,G as ot,H as ct,I as ut,J as ft,K as we,A as dt}from"../chunks/index.1f09d107.js";import{g as ht}from"../chunks/CardView.svelte_svelte_type_style_lang.7b5fa6f7.js";import{w as pe}from"../chunks/index.baa64f0d.js";const mt=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function ke(n,e){const t=e.token={};function s(r,a,l,i){if(e.token!==t)return;e.resolved=i;let o=e.ctx;l!==void 0&&(o=o.slice(),o[l]=i);const c=r&&(e.current=r)(o);let u=!1;e.block&&(e.blocks?e.blocks.forEach((d,f)=>{f!==a&&d&&(F(),I(d,1,1,()=>{e.blocks[f]===d&&(e.blocks[f]=null)}),N())}):e.block.d(1),c.c(),y(c,1),c.m(e.mount(),e.anchor),u=!0),e.block=c,e.blocks&&(e.blocks[a]=c),u&&Je()}if(Ge(n)){const r=Ye();if(n.then(a=>{ee(r),s(e.then,1,e.value,a),ee(null)},a=>{if(ee(r),s(e.catch,2,e.error,a),ee(null),!e.hasCatch)throw a}),e.current!==e.pending)return s(e.pending,0),!0}else{if(e.current!==e.then)return s(e.then,1,e.value,n),!0;e.resolved=n}}function pt(n,e,t){const s=e.slice(),{resolved:r}=n;n.current===n.then&&(s[n.value]=r),n.current===n.catch&&(s[n.error]=r),n.block.p(s,t)}function T(n){return(n==null?void 0:n.length)!==void 0?n:Array.from(n)}function _t(n,e){I(n,1,1,()=>{e.delete(n.key)})}function gt(n,e,t,s,r,a,l,i,o,c,u,d){let f=n.length,m=a.length,p=f;const h={};for(;p--;)h[n[p].key]=p;const g=[],v=new Map,A=new Map,j=[];for(p=m;p--;){const P=d(r,a,p),V=t(P);let L=l.get(V);L?s&&j.push(()=>L.p(P,e)):(L=c(V,P),L.c()),v.set(V,g[p]=L),V in h&&A.set(V,Math.abs(p-h[V]))}const q=new Set,Z=new Set;function ie(P){y(P,1),P.m(i,u),l.set(P.key,P),u=P.first,m--}for(;f&&m;){const P=g[m-1],V=n[f-1],L=P.key,K=V.key;P===V?(u=P.first,f--,m--):v.has(K)?!l.has(L)||q.has(L)?ie(P):Z.has(K)?f--:A.get(L)>A.get(K)?(Z.add(L),ie(P)):(q.add(K),f--):(o(V,l),f--)}for(;f--;){const P=n[f];v.has(P.key)||o(P,l)}for(;m;)ie(g[m-1]);return de(j),g}function vt(n){let e,t,s=`${n[0]}%`;return{c(){e=E("div"),t=E("div"),this.h()},l(r){e=S(r,"DIV",{class:!0});var a=$(e);t=S(a,"DIV",{class:!0}),$(t).forEach(_),a.forEach(_),this.h()},h(){b(t,"class","value relative h-full transition-all bg-white duration-200"),M(t,"width",s),b(e,"class","w-8 h-1 2xs:w-10 2xs:h-1.5 xs:w-12 xs:h-2 bg-gray-800 shadow-lg")},m(r,a){D(r,e,a),k(e,t)},p(r,[a]){a&1&&s!==(s=`${r[0]}%`)&&M(t,"width",s)},i:w,o:w,d(r){r&&_(e)}}}function bt(n,e,t){let{value:s}=e;return n.$$set=r=>{"value"in r&&t(0,s=r.value)},[s]}class wt extends R{constructor(e){super(),W(this,e,bt,vt,z,{value:0})}}const Y=pe();function kt(n){let e,t,s,r;function a(c,u,d){c==="panstart"&&(s=u,r=d);const f={x:u,y:d,dx:u-e,dy:d-t,startY:r,startX:s,totalDeltaX:u-s,totalDeltaY:d-r};return e=u,t=d,new CustomEvent(c,{detail:f})}function l(c){n.dispatchEvent(a("panstart",c.clientX,c.clientY)),window.addEventListener("pointermove",i),window.addEventListener("pointerup",o)}function i(c){n.dispatchEvent(a("panmove",c.clientX,c.clientY))}function o(c){n.dispatchEvent(a("panend",c.clientX,c.clientY)),window.removeEventListener("pointermove",i),window.removeEventListener("pointerup",o)}return n.addEventListener("pointerdown",l),{destroy(){n.removeEventListener("pointerdown",l)}}}const yt="/scenarios/default.json";var Te=(n=>(n[n.Left=-1]="Left",n[n.Right=1]="Right",n))(Te||{});const Be=250,ye=100;function Ee(n){return Object.prototype.toString.call(n)==="[object Date]"}function fe(n,e,t,s){if(typeof t=="number"||Ee(t)){const r=s-t,a=(t-e)/(n.dt||1/60),l=n.opts.stiffness*r,i=n.opts.damping*a,o=(l-i)*n.inv_mass,c=(a+o)*n.dt;return Math.abs(c)<n.opts.precision&&Math.abs(r)<n.opts.precision?s:(n.settled=!1,Ee(t)?new Date(t.getTime()+c):t+c)}else{if(Array.isArray(t))return t.map((r,a)=>fe(n,e[a],t[a],s[a]));if(typeof t=="object"){const r={};for(const a in t)r[a]=fe(n,e[a],t[a],s[a]);return r}else throw new Error(`Cannot spring ${typeof t} values`)}}function Et(n,e={}){const t=pe(n),{stiffness:s=.15,damping:r=.8,precision:a=.01}=e;let l,i,o,c=n,u=n,d=1,f=0,m=!1;function p(g,v={}){u=g;const A=o={};return n==null||v.hard||h.stiffness>=1&&h.damping>=1?(m=!0,l=be(),c=g,t.set(n=u),Promise.resolve()):(v.soft&&(f=1/((v.soft===!0?.5:+v.soft)*60),d=0),i||(l=be(),m=!1,i=it(j=>{if(m)return m=!1,i=null,!1;d=Math.min(d+f,1);const q={inv_mass:d,opts:h,settled:!0,dt:(j-l)*60/1e3},Z=fe(q,c,n,u);return l=j,c=n,t.set(n=Z),q.settled&&(i=null),!q.settled})),new Promise(j=>{i.promise.then(()=>{A===o&&j()})}))}const h={set:p,update:(g,v)=>p(g(u,n),v),subscribe:t.subscribe,stiffness:s,damping:r,precision:a};return h}function St(n){const e=n-1;return e*e*e+1}function Se(n,e,t){const s=n.slice();return s[14]=e[t],s}function Me(n){let e,t,s=T(De),r=[];for(let a=0;a<s.length;a+=1)r[a]=Ie(Se(n,s,a));return{c(){e=E("div");for(let a=0;a<r.length;a+=1)r[a].c();this.h()},l(a){e=S(a,"DIV",{class:!0,style:!0});var l=$(e);for(let i=0;i<r.length;i+=1)r[i].l(l);l.forEach(_),this.h()},h(){b(e,"class",t="absolute overflow-hidden "+n[1]),M(e,"transition","border-width 0.2s"),M(e,"border-color","#fff"),M(e,"border-style","solid"),M(e,"border-width",It)},m(a,l){D(a,e,l);for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(e,null)},p(a,l){if(l&97){s=T(De);let i;for(i=0;i<s.length;i+=1){const o=Se(a,s,i);r[i]?r[i].p(o,l):(r[i]=Ie(o),r[i].c(),r[i].m(e,null))}for(;i<r.length;i+=1)r[i].d(1);r.length=s.length}l&2&&t!==(t="absolute overflow-hidden "+a[1])&&b(e,"class",t)},d(a){a&&_(e),He(r,a)}}}function Ie(n){let e,t,s=n[0][n[14]].description+"",r,a;return{c(){e=E("div"),t=E("span"),r=ne(s),a=x(),this.h()},l(l){e=S(l,"DIV",{class:!0,style:!0});var i=$(e);t=S(i,"SPAN",{class:!0,style:!0});var o=$(t);r=re(o,s),o.forEach(_),a=C(i),i.forEach(_),this.h()},h(){b(t,"class","relative block bg-black bg-opacity-80 text-md w-[100%] px-[30%] py-[5%] pt-[30%]"),M(t,"text-shadow","0 2px 4px #000"),M(t,"text-align",n[14]==="left"?"right":"left"),M(t,"transition","transform 0.2s"),M(t,"transform","translate3d(0, "+(n[14]===n[6]?"0":"-10px")+", 0)"),b(e,"class","absolute top-[-50%] left-[50%] w-[200%]"),M(e,"transform","translate3d(-50%, 0, 0) rotate3d(0, 0, 1, "+n[5].x*-.05+"deg)"),M(e,"transition","opacity 0.2s"),M(e,"opacity",n[14]===n[6]?1:0),M(e,"overflow","hidden")},m(l,i){D(l,e,i),k(e,t),k(t,r),k(e,a)},p(l,i){i&1&&s!==(s=l[0][l[14]].description+"")&&ae(r,s),i&64&&M(t,"transform","translate3d(0, "+(l[14]===l[6]?"0":"-10px")+", 0)"),i&32&&M(e,"transform","translate3d(-50%, 0, 0) rotate3d(0, 0, 1, "+l[5].x*-.05+"deg)"),i&64&&M(e,"opacity",l[14]===l[6]?1:0)},d(l){l&&_(e)}}}function Mt(n){let e,t,s,r,a,l,i=n[3]&&Me(n);const o=n[12].default,c=Ze(o,n,n[11],null);return{c(){e=E("div"),i&&i.c(),t=x(),c&&c.c(),this.h()},l(u){e=S(u,"DIV",{class:!0,style:!0});var d=$(e);i&&i.l(d),t=C(d),c&&c.l(d),d.forEach(_),this.h()},h(){b(e,"class","shadow-md rounded-md cursor-move select-none relative"),b(e,"style",s="transform: translate3d("+n[5].x+"px, "+n[5].y+"px, 0) rotate3d(0, 0, 1, "+n[5].x*.05+"deg); "+(n[2]?$e:""))},m(u,d){D(u,e,d),i&&i.m(e,null),k(e,t),c&&c.m(e,null),r=!0,a||(l=[Ke(kt.call(null,e)),J(e,"panstart",n[7]),J(e,"panmove",n[8]),J(e,"panend",n[9])],a=!0)},p(u,[d]){u[3]?i?i.p(u,d):(i=Me(u),i.c(),i.m(e,t)):i&&(i.d(1),i=null),c&&c.p&&(!r||d&2048)&&et(c,o,u,u[11],r?st(o,u[11],d,null):tt(u[11]),null),(!r||d&36&&s!==(s="transform: translate3d("+u[5].x+"px, "+u[5].y+"px, 0) rotate3d(0, 0, 1, "+u[5].x*.05+"deg); "+(u[2]?$e:"")))&&b(e,"style",s)},i(u){r||(y(c,u),r=!0)},o(u){I(c,u),r=!1},d(u){u&&_(e),i&&i.d(),c&&c.d(u),a=!1,de(l)}}}const $e=`transition: transform ${Be}ms ease-out`,De=["left","right"];let It="";function $t(n,e,t){let s,r;se(n,Y,v=>t(6,r=v));let{$$slots:a={},$$scope:l}=e,{onSwipe:i}=e,{actions:o}=e,{imageSize:c}=e,u=!1,d;const f=Et({x:0,y:0},{stiffness:.2,damping:.4});se(n,f,v=>t(5,s=v));function m(){t(4,f.stiffness=t(4,f.damping=1,f),f)}function p(v){f.update(()=>({x:s.x+v.detail.dx,y:s.y+v.detail.dy})),t(3,d=Math.sign(v.detail.totalDeltaX)),Math.abs(v.detail.totalDeltaX)>.25*ye?G(Y,r=d<0?"left":"right",r):G(Y,r=void 0,r)}function h(v){return new Promise(function(A){setTimeout(function(){i(v),A()},Be)})}async function g(v){G(Y,r=void 0,r),Math.abs(v.detail.totalDeltaX)>ye&&d!==void 0?(t(2,u=!0),G(f,s.x=v.target.clientWidth+Math.max(window.innerHeight,window.innerWidth)*d,s),await h(d),t(2,u=!1)):(t(4,f.stiffness=.2,f),t(4,f.damping=.8,f)),t(3,d=void 0),f.set({x:0,y:0})}return n.$$set=v=>{"onSwipe"in v&&t(10,i=v.onSwipe),"actions"in v&&t(0,o=v.actions),"imageSize"in v&&t(1,c=v.imageSize),"$$scope"in v&&t(11,l=v.$$scope)},[o,c,u,d,f,s,r,m,p,g,i,l,a]}class Dt extends R{constructor(e){super(),W(this,e,$t,Mt,z,{onSwipe:10,actions:0,imageSize:1})}}function Pt(n,{delay:e=0,duration:t=400,easing:s=nt}={}){const r=+getComputedStyle(n).opacity;return{delay:e,duration:t,easing:s,css:a=>`opacity: ${a*r}`}}function Qe(n,{delay:e=0,duration:t=400,easing:s=St,x:r=0,y:a=0,opacity:l=0}={}){const i=getComputedStyle(n),o=+i.opacity,c=i.transform==="none"?"":i.transform,u=o*(1-l),[d,f]=_e(r),[m,p]=_e(a);return{delay:e,duration:t,easing:s,css:(h,g)=>`
			transform: ${c} translate(${(1-h)*d}${f}, ${(1-h)*m}${p});
			opacity: ${o-u*g}`}}function Pe(n){let e,t,s=n[0].text+"",r,a;return{c(){e=E("div"),t=E("p"),r=ne(s),this.h()},l(l){e=S(l,"DIV",{class:!0});var i=$(e);t=S(i,"P",{});var o=$(t);r=re(o,s),o.forEach(_),i.forEach(_),this.h()},h(){b(e,"class","w-full h-full grid place-items-center")},m(l,i){D(l,e,i),k(e,t),k(t,r)},p(l,i){i&1&&s!==(s=l[0].text+"")&&ae(r,s)},i(l){l&&(a||he(()=>{a=me(t,Qe,{duration:200,delay:200,y:-5}),a.start()}))},o:w,d(l){l&&_(e)}}}function Ae(n){let e,t;return{c(){e=E("div"),this.h()},l(s){e=S(s,"DIV",{style:!0,class:!0}),$(e).forEach(_),this.h()},h(){M(e,"background-image","url("+n[0].image+")"),b(e,"class","bg-no-repeat bg-center "+te+" z-10 bg-cover svelte-187ocyj")},m(s,r){D(s,e,r)},p(s,r){r&1&&M(e,"background-image","url("+s[0].image+")")},i(s){s&&(t||he(()=>{t=me(e,Qe,{duration:200,y:-5}),t.start()}))},o:w,d(s){s&&_(e)}}}function At(n){let e=n[0],t,s=Ae(n);return{c(){s.c(),t=O()},l(r){s.l(r),t=O()},m(r,a){s.m(r,a),D(r,t,a)},p(r,a){a&1&&z(e,e=r[0])?(F(),I(s,1,1,w),N(),s=Ae(r),s.c(),y(s,1),s.m(t.parentNode,t)):s.p(r,a)},d(r){r&&_(t),s.d(r)}}}function je(n){let e,t,s=n[0].title+"",r,a,l,i=n[0].location+"",o,c;return{c(){e=E("div"),t=E("h2"),r=ne(s),a=x(),l=E("p"),o=ne(i),this.h()},l(u){e=S(u,"DIV",{class:!0});var d=$(e);t=S(d,"H2",{});var f=$(t);r=re(f,s),f.forEach(_),a=C(d),l=S(d,"P",{class:!0});var m=$(l);o=re(m,i),m.forEach(_),d.forEach(_),this.h()},h(){b(l,"class","text-gray-300"),b(e,"class","h-full")},m(u,d){D(u,e,d),k(e,t),k(t,r),k(e,a),k(e,l),k(l,o)},p(u,d){d&1&&s!==(s=u[0].title+"")&&ae(r,s),d&1&&i!==(i=u[0].location+"")&&ae(o,i)},i(u){u&&(c||he(()=>{c=me(e,Pt,{duration:200,delay:200}),c.start()}))},o:w,d(u){u&&_(e)}}}function jt(n){let e,t,s=n[0],r,a,l,i,o,c,u,d=n[0],f,m=Pe(n);o=new Dt({props:{onSwipe:n[1],actions:n[0].actions,imageSize:te,$$slots:{default:[At]},$$scope:{ctx:n}}});let p=je(n);return{c(){e=E("div"),t=E("div"),m.c(),r=x(),a=E("div"),l=E("div"),i=x(),B(o.$$.fragment),c=x(),u=E("div"),p.c(),this.h()},l(h){e=S(h,"DIV",{class:!0});var g=$(e);t=S(g,"DIV",{class:!0});var v=$(t);m.l(v),v.forEach(_),r=C(g),a=S(g,"DIV",{class:!0});var A=$(a);l=S(A,"DIV",{class:!0}),$(l).forEach(_),i=C(A),Q(o.$$.fragment,A),A.forEach(_),c=C(g),u=S(g,"DIV",{class:!0});var j=$(u);p.l(j),j.forEach(_),g.forEach(_),this.h()},h(){b(t,"class","h-36 2xs:h-44 xs:h-56 xs:py-4 text-center px-4 xs:px-8"),b(l,"class","absolute z-0 "+te+" top-0 left-0 bg-gray-900 svelte-187ocyj"),b(a,"class",te+" relative svelte-187ocyj"),b(u,"class","h-14 text-center my-2 xs:my-4"),b(e,"class","flex flex-col items-center justify-center text-white 2xs:text-lg xs:text-xl font-light max-w-prose m-auto card svelte-187ocyj")},m(h,g){D(h,e,g),k(e,t),m.m(t,null),k(e,r),k(e,a),k(a,l),k(a,i),U(o,a,null),k(e,c),k(e,u),p.m(u,null),f=!0},p(h,[g]){g&1&&z(s,s=h[0])?(F(),I(m,1,1,w),N(),m=Pe(h),m.c(),y(m,1),m.m(t,null)):m.p(h,g);const v={};g&2&&(v.onSwipe=h[1]),g&1&&(v.actions=h[0].actions),g&5&&(v.$$scope={dirty:g,ctx:h}),o.$set(v),g&1&&z(d,d=h[0])?(F(),I(p,1,1,w),N(),p=je(h),p.c(),y(p,1),p.m(u,null)):p.p(h,g)},i(h){f||(y(m),y(o.$$.fragment,h),y(p),f=!0)},o(h){I(m),I(o.$$.fragment,h),I(p),f=!1},d(h){h&&_(e),m.d(h),X(o),p.d(h)}}}const te="w-[60vmin] h-[60vmin] 2xs:w-[85vmin] 2xs:h-[85vmin] max-w-[400px] max-h-[400px] rounded-lg";function xt(n,e,t){let{card:s}=e,{onSwipe:r}=e;return rt(async()=>{await at()}),n.$$set=a=>{"card"in a&&t(0,s=a.card),"onSwipe"in a&&t(1,r=a.onSwipe)},[s,r]}class Ct extends R{constructor(e){super(),W(this,e,xt,jt,z,{card:0,onSwipe:1})}}const{document:le}=mt;function xe(n,e,t){const s=n.slice();return s[5]=e[t],s}function Ce(n){let e,t;return{c(){e=E("link"),this.h()},l(s){e=S(s,"LINK",{rel:!0,as:!0,href:!0}),this.h()},h(){b(e,"rel","preload"),b(e,"as","image"),b(e,"href",t=n[5])},m(s,r){D(s,e,r)},p(s,r){r&1&&t!==(t=s[5])&&b(e,"href",t)},d(s){s&&_(e)}}}function Ve(n){let e,t;return e=new Ct({props:{card:n[1].card,onSwipe:n[4]}}),{c(){B(e.$$.fragment)},l(s){Q(e.$$.fragment,s)},m(s,r){U(e,s,r),t=!0},p(s,r){const a={};r&2&&(a.card=s[1].card),e.$set(a)},i(s){t||(y(e.$$.fragment,s),t=!0)},o(s){I(e.$$.fragment,s),t=!1},d(s){X(e,s)}}}function Vt(n){let e,t,s,r,a,l,i,o,c=T(n[0].preloadAssets),u=[];for(let f=0;f<c.length;f+=1)u[f]=Ce(xe(n,c,f));r=new Tt({props:{stats:n[2]}});let d=n[1].card&&Ve(n);return{c(){for(let f=0;f<u.length;f+=1)u[f].c();e=O(),t=x(),s=E("main"),B(r.$$.fragment),a=x(),d&&d.c(),this.h()},l(f){const m=lt("svelte-i83wkk",le.head);for(let h=0;h<u.length;h+=1)u[h].l(m);e=O(),m.forEach(_),t=C(f),s=S(f,"MAIN",{class:!0});var p=$(s);Q(r.$$.fragment,p),a=C(p),d&&d.l(p),p.forEach(_),this.h()},h(){b(s,"class","text-white")},m(f,m){for(let p=0;p<u.length;p+=1)u[p]&&u[p].m(le.head,null);k(le.head,e),D(f,t,m),D(f,s,m),U(r,s,null),k(s,a),d&&d.m(s,null),l=!0,i||(o=[J(s,"dragstart",Le),J(s,"select",Le)],i=!0)},p(f,[m]){if(m&1){c=T(f[0].preloadAssets);let h;for(h=0;h<c.length;h+=1){const g=xe(f,c,h);u[h]?u[h].p(g,m):(u[h]=Ce(g),u[h].c(),u[h].m(e.parentNode,e))}for(;h<u.length;h+=1)u[h].d(1);u.length=c.length}const p={};m&4&&(p.stats=f[2]),r.$set(p),f[1].card?d?(d.p(f,m),m&2&&y(d,1)):(d=Ve(f),d.c(),y(d,1),d.m(s,null)):d&&(F(),I(d,1,1,()=>{d=null}),N())},i(f){l||(y(r.$$.fragment,f),y(d),l=!0)},o(f){I(r.$$.fragment,f),I(d),l=!1},d(f){f&&(_(t),_(s)),He(u,f),_(e),X(r),d&&d.d(),i=!1,de(o)}}}function Le(n){return n.preventDefault(),n.stopPropagation(),!1}function Lt(n,e,t){let s,{game:r}=e;const a=pe(r.initialState);se(n,a,o=>t(1,s=o));let l;function i(o){const c=o===Te.Left?s.card.actions.left.modifier:s.card.actions.right.modifier;G(a,s=r.applyAction(s,c),s)}return qe(()=>(document.documentElement.classList.add("in-game"),()=>document.documentElement.classList.remove("in-game"))),n.$$set=o=>{"game"in o&&t(0,r=o.game)},n.$$.update=()=>{n.$$.dirty&3&&t(2,l=r.stats.map(o=>Object.assign({},o,{value:o.getValue(s),indicators:{left:o.getIndicator(s,s.card.actions.left.modifier),right:o.getIndicator(s,s.card.actions.right.modifier)}})))},[r,s,l,a,i]}class zt extends R{constructor(e){super(),W(this,e,Lt,Vt,z,{game:0})}}function Ot(n){let e,t,s='<path fill="currentColor" fill-rule="evenodd" d="M18 10a8 8 0 1 1-16 0a8 8 0 0 1 16 0ZM8.94 6.94a.75.75 0 1 1-1.061-1.061a3 3 0 1 1 2.871 5.026v.345a.75.75 0 0 1-1.5 0v-.5c0-.72.57-1.172 1.081-1.287A1.5 1.5 0 1 0 8.94 6.94ZM10 15a1 1 0 1 0 0-2a1 1 0 0 0 0 2Z" clip-rule="evenodd"/>',r=[{viewBox:"0 0 20 20"},{width:"1.2em"},{height:"1.2em"},n[0]],a={};for(let l=0;l<r.length;l+=1)a=ue(a,r[l]);return{c(){e=ot("svg"),t=new ct(!0),this.h()},l(l){e=ut(l,"svg",{viewBox:!0,width:!0,height:!0});var i=$(e);t=ft(i,!0),i.forEach(_),this.h()},h(){t.a=null,we(e,a)},m(l,i){D(l,e,i),t.m(s,e)},p(l,[i]){we(e,a=ht(r,[{viewBox:"0 0 20 20"},{width:"1.2em"},{height:"1.2em"},i&1&&l[0]]))},i:w,o:w,d(l){l&&_(e)}}}function Ft(n,e,t){return n.$$set=s=>{t(0,e=ue(ue({},e),ge(s)))},e=ge(e),[e]}class Nt extends R{constructor(e){super(),W(this,e,Ft,Ot,z,{})}}function ze(n,e,t){const s=n.slice();return s[2]=e[t],s}function oe(n){const e=n.slice(),t=e[2].indicators[e[1]];return e[5]=t,e}function Oe(n){let e,t,s,r;const a=[Wt,Rt],l=[];function i(o,c){return o[5]==="unknown"?0:o[5]!==0?1:-1}return~(e=i(n))&&(t=l[e]=a[e](n)),{c(){t&&t.c(),s=O()},l(o){t&&t.l(o),s=O()},m(o,c){~e&&l[e].m(o,c),D(o,s,c),r=!0},p(o,c){let u=e;e=i(o),e===u?~e&&l[e].p(o,c):(t&&(F(),I(l[u],1,1,()=>{l[u]=null}),N()),~e?(t=l[e],t?t.p(o,c):(t=l[e]=a[e](o),t.c()),y(t,1),t.m(s.parentNode,s)):t=null)},i(o){r||(y(t),r=!0)},o(o){I(t),r=!1},d(o){o&&_(s),~e&&l[e].d(o)}}}function Rt(n){let e,t;return{c(){e=E("div"),this.h()},l(s){e=S(s,"DIV",{class:!0}),$(e).forEach(_),this.h()},h(){b(e,"class",t="bg-black rounded-full aspect-square absolute "+(n[5]>0?"top-0 -translate-y-1/2":"bottom-0 translate-y-1/2")),M(e,"width",n[5]>0?"30%":"20%")},m(s,r){D(s,e,r)},p(s,r){r&3&&t!==(t="bg-black rounded-full aspect-square absolute "+(s[5]>0?"top-0 -translate-y-1/2":"bottom-0 translate-y-1/2"))&&b(e,"class",t),r&3&&M(e,"width",s[5]>0?"30%":"20%")},i:w,o:w,d(s){s&&_(e)}}}function Wt(n){let e,t,s;return t=new Nt({}),{c(){e=E("div"),B(t.$$.fragment),this.h()},l(r){e=S(r,"DIV",{class:!0});var a=$(e);Q(t.$$.fragment,a),a.forEach(_),this.h()},h(){b(e,"class","text-black text-base rounded-full aspect-square bg-white absolute top-0 -translate-y-1/2")},m(r,a){D(r,e,a),U(t,e,null),s=!0},p:w,i(r){s||(y(t.$$.fragment,r),s=!0)},o(r){I(t.$$.fragment,r),s=!1},d(r){r&&_(e),X(t)}}}function Fe(n,e){let t,s,r,a,l,i,o,c,u,d,f,m=e[1]&&Oe(oe(e));return c=new wt({props:{value:e[2].value}}),{key:n,first:null,c(){t=E("div"),s=E("div"),r=E("img"),i=x(),m&&m.c(),o=x(),B(c.$$.fragment),u=x(),this.h()},l(p){t=S(p,"DIV",{class:!0,title:!0});var h=$(t);s=S(h,"DIV",{class:!0});var g=$(s);r=S(g,"IMG",{src:!0,class:!0,alt:!0}),i=C(g),m&&m.l(g),g.forEach(_),o=C(h),Q(c.$$.fragment,h),u=C(h),h.forEach(_),this.h()},h(){ve(r.src,a=e[2].icon.src)||b(r,"src",a),b(r,"class","w-full h-full object-contain"),b(r,"alt",l=e[2].name+" icon"),M(r,"width",e[2].icon.size?e[2].icon.size:""),M(r,"height",e[2].icon.size?e[2].icon.size:""),b(s,"class","w-8 h-8 2xs:w-10 2xs:h-10 xs:w-12 xs:h-12 rounded-full bg-white grid place-items-center shadow-lg mb-2 xs:mb-3 text-black text-sm relative"),b(t,"class","flex justify-between items-center flex-col"),b(t,"title",d=e[2].name),this.first=t},m(p,h){D(p,t,h),k(t,s),k(s,r),k(s,i),m&&m.m(s,null),k(t,o),U(c,t,null),k(t,u),f=!0},p(p,h){e=p,(!f||h&1&&!ve(r.src,a=e[2].icon.src))&&b(r,"src",a),(!f||h&1&&l!==(l=e[2].name+" icon"))&&b(r,"alt",l),h&1&&M(r,"width",e[2].icon.size?e[2].icon.size:""),h&1&&M(r,"height",e[2].icon.size?e[2].icon.size:""),e[1]?m?(m.p(oe(e),h),h&2&&y(m,1)):(m=Oe(oe(e)),m.c(),y(m,1),m.m(s,null)):m&&(F(),I(m,1,1,()=>{m=null}),N());const g={};h&1&&(g.value=e[2].value),c.$set(g),(!f||h&1&&d!==(d=e[2].name))&&b(t,"title",d)},i(p){f||(y(m),y(c.$$.fragment,p),f=!0)},o(p){I(m),I(c.$$.fragment,p),f=!1},d(p){p&&_(t),m&&m.d(),X(c)}}}function qt(n){let e,t=[],s=new Map,r,a=T(n[0]);const l=i=>i[2].name;for(let i=0;i<a.length;i+=1){let o=ze(n,a,i),c=l(o);s.set(c,t[i]=Fe(c,o))}return{c(){e=E("header");for(let i=0;i<t.length;i+=1)t[i].c();this.h()},l(i){e=S(i,"HEADER",{class:!0});var o=$(e);for(let c=0;c<t.length;c+=1)t[c].l(o);o.forEach(_),this.h()},h(){b(e,"class","flex bg-green-700 xs:space-x-10 justify-around xs:justify-center items-center p-2 2xs:p-4 shadow-lg")},m(i,o){D(i,e,o);for(let c=0;c<t.length;c+=1)t[c]&&t[c].m(e,null);r=!0},p(i,[o]){o&3&&(a=T(i[0]),F(),t=gt(t,o,l,1,i,a,s,e,_t,Fe,null,ze),N())},i(i){if(!r){for(let o=0;o<a.length;o+=1)y(t[o]);r=!0}},o(i){for(let o=0;o<t.length;o+=1)I(t[o]);r=!1},d(i){i&&_(e);for(let o=0;o<t.length;o+=1)t[o].d()}}}function Ht(n,e,t){let s;se(n,Y,a=>t(1,s=a));let{stats:r}=e;return n.$$set=a=>{"stats"in a&&t(0,r=a.stats)},[r,s]}class Tt extends R{constructor(e){super(),W(this,e,Ht,qt,z,{stats:0})}}function Bt(n,e){return e.some(t=>Qt(n,t))}function Qt(n,{vars:e={}}){return Object.entries(e).every(([s,r])=>{if(Array.isArray(r)){const[a,l]=r;return n.vars[s]>=a&&n.vars[s]<=l}else return n.vars[s]===r})}class Ut{constructor(e,t,s,r,a={}){H(this,"_cards");H(this,"_random");H(this,"_tickModifiers");H(this,"_stats");H(this,"_initialParams");const{random:l=Math.random,tickModifiers:i=[]}=a;this._cards=e,this._random=l,this._tickModifiers=i,this._initialParams=r,this._stats=t.map(o=>s(this,o))}get stats(){return this._stats}get initialState(){return this.applyAction({params:this._initialParams},e=>e)}get preloadAssets(){return this._cards.map(e=>e.image)}applyAction(e,t){const s=this._applyModifiers({...e,card:void 0},[t,...this._tickModifiers]);return s.card?s:{...s,card:this._selectWeightedRandomFrom(this._getAvailableCards(s))}}_applyModifiers(e,t){return t.reduce((s,r)=>r(s),e)}_getAvailableCards(e){const t=this._cards.filter(a=>a.match(e)),s={};for(const a of t)s[a.priority]=s[a.priority]?s[a.priority].concat(a):[a];let r=Math.min(...Object.keys(s).map(a=>parseInt(a,10)));return s[r]}_selectWeightedRandomFrom(e,t=s=>s.weight){const{selectionList:s,count:r}=e.reduce((i,o)=>(i.count+=t(o),i.selectionList.push(i.count),i),{count:0,selectionList:[]}),a=this._random()*r,l=s.findIndex((i,o,c)=>{const u=o>0?c[o-1]:0;return a>=u&&a<=i});return e[l]}}const Xt=n=>({...n,params:{vars:{...n.params.vars,rounds:(n.params.vars.rounds??0)+1}}});function Gt(n,e){return t=>({...t,params:{vars:{...t.params.vars,[n]:((t.params.vars[n]??0)+1)%e}}})}function ce(n,e,t,s){return r=>{const a=r.params,l=e.map(o=>a.vars[o]??0),i=s?l.reduce((o,c)=>t(o,c),s):l.reduce((o,c)=>t(o,c));return{...r,params:{vars:{...r.params.vars,[n]:i}}}}}function Yt(n){return e=>{const t=e.params,s=n===void 0?t.vars:n.reduce((r,a)=>(r[a]=t.vars[a],r),{});return Object.keys(s).length>0&&console.table(s),e}}function Jt(n){return e=>({...e,params:{vars:{...e.params.vars,...n.reduce((t,s)=>{const r=e.params.vars[s.id];return r!==void 0&&(t[s.id]=Math.max(s.min,Math.min(s.max,r))),t},{})}}})}function Zt(n){return n.map(e=>{switch(e.type){case"round":return Xt;case"cycle":return Gt(e.id,e.length);case"min":return ce(e.targetId,e.sourceIds,(t,s)=>Math.min(t,s));case"max":return ce(e.targetId,e.sourceIds,(t,s)=>Math.max(t,s));case"sum":return ce(e.targetId,e.sourceIds,(t,s)=>t+s,0);case"debug":return Yt(e.stateIds);default:throw new Error("Missing modifier type: "+e.type)}})}function Kt(n,e=Math.random){const t={vars:n.defaultState.state},s=n.cards.reduce((o,c)=>(o[c.id]=c,o),{}),r=rs(s,t);console.log("Loaded cards:",r);const a=ss(n.stats),l=es(n.stats),i=Zt(n.worldStateModifiers);return new Ut(Object.values(r),l,ts,t,{tickModifiers:[a,...i],random:e})}function es(n){return n.map(e=>({...e,getValue:({params:t})=>t.vars[e.id]??0}))}function ts(n,e){return{...e,getIndicator:(t,s)=>{const r=(t.card.actions.left.modifier===s,t.card.actions.left.indicatorState);return r==="visible"?n.applyAction(t,s).params.vars[e.id]-t.params.vars[e.id]:r==="hidden"?0:"unknown"}}}function ss(n){return Jt(n)}function ns(n,e){const t=("isAvailableWhen"in n?n.isAvailableWhen:[]).map(as);return{id:n.id,image:n.image,title:n.title,text:n.text,location:n.location,match:s=>Bt(s.params,t),weight:n.weight,actions:{left:Re(n.actions.left,e,"No"),right:Re(n.actions.right,e,"Yes")},priority:n.priority}}function rs(n,e){const t=Object.keys(n).reduce((s,r)=>{const a=n[r];return s[r]=ns(a,e),s},{});for(const s in t){const r=n[s],a=t[s];a.actions.left.modifier=Ne(r.actions.left,t,a.actions.left.modifier),a.actions.right.modifier=Ne(r.actions.right,t,a.actions.right.modifier)}return t}function Ne(n,e,t){const s=n.next?e[n.next]:void 0;return s?r=>({...t(r),card:s}):t}function Re(n,e,t){return{description:n.description??t,indicatorState:n.indicatorState??"visible",modifier:s=>is(s,n.modifiers,e),next:n.next}}function as(n){return{vars:n.state}}function is(n,e,t){return{...n,params:{vars:e.reduce((s,r)=>ls(s,r,t.vars),n.params.vars)}}}function ls(n,e,t){const s=e.type==="replace"?Object.assign({},t):Object.assign({},n),r=e.state||{};return Object.entries(r).reduce((l,[i,o])=>{const c=e.type==="set"||e.type==="replace"?o:o+(l[i]||0);return l[i]=c,l},s)}async function os(n){const e=n.match(/^local:\/\/(.*)/);if(e){const s="game_world:"+e[1],r={stats:[],cards:[],defaultState:{state:{}},worldStateModifiers:[]},a=localStorage.getItem(s),l=a?JSON.parse(a):null;if(!l)throw new Error("Could not load data from local storage: "+s);return Object.assign(r,l)}return null}async function cs(n){return await os(n)||await us(n)}async function us(n){return console.log("Fetching path: ",n),await(await window.fetch(n)).json()}function fs(n){let e,t="Loading...";return{c(){e=E("p"),e.textContent=t,this.h()},l(s){e=S(s,"P",{class:!0,"data-svelte-h":!0}),dt(e)!=="svelte-zq1s2g"&&(e.textContent=t),this.h()},h(){b(e,"class","grid place-items-center text-white font-black text-2xl tracking-widest h-[60vh]")},m(s,r){D(s,e,r)},p:w,i:w,o:w,d(s){s&&_(e)}}}function ds(n){let e,t,s,r={ctx:n,current:null,token:null,hasCatch:!1,pending:ps,then:ms,catch:hs,value:1,blocks:[,,,]};return ke(t=We(n[0]),r),{c(){e=O(),r.block.c()},l(a){e=O(),r.block.l(a)},m(a,l){D(a,e,l),r.block.m(a,r.anchor=l),r.mount=()=>e.parentNode,r.anchor=e,s=!0},p(a,l){n=a,r.ctx=n,l&1&&t!==(t=We(n[0]))&&ke(t,r)||pt(r,n,l)},i(a){s||(y(r.block),s=!0)},o(a){for(let l=0;l<3;l+=1){const i=r.blocks[l];I(i)}s=!1},d(a){a&&_(e),r.block.d(a),r.token=null,r=null}}}function hs(n){return{c:w,l:w,m:w,p:w,i:w,o:w,d:w}}function ms(n){let e,t;return e=new zt({props:{game:n[1]}}),{c(){B(e.$$.fragment)},l(s){Q(e.$$.fragment,s)},m(s,r){U(e,s,r),t=!0},p(s,r){const a={};r&1&&(a.game=s[1]),e.$set(a)},i(s){t||(y(e.$$.fragment,s),t=!0)},o(s){I(e.$$.fragment,s),t=!1},d(s){X(e,s)}}}function ps(n){return{c:w,l:w,m:w,p:w,i:w,o:w,d:w}}function _s(n){let e,t,s,r;const a=[ds,fs],l=[];function i(o,c){return o[0]?0:1}return e=i(n),t=l[e]=a[e](n),{c(){t.c(),s=O()},l(o){t.l(o),s=O()},m(o,c){l[e].m(o,c),D(o,s,c),r=!0},p(o,[c]){let u=e;e=i(o),e===u?l[e].p(o,c):(F(),I(l[u],1,1,()=>{l[u]=null}),N(),t=l[e],t?t.p(o,c):(t=l[e]=a[e](o),t.c()),y(t,1),t.m(s.parentNode,s))},i(o){r||(y(t),r=!0)},o(o){I(t),r=!1},d(o){o&&_(s),l[e].d(o)}}}async function We(n){const e=await cs(n);if(e)return Kt(e);throw new Error(`Could not load scenario data: ${n}`)}function gs(n,e,t){let s;return qe(()=>{const r=new URLSearchParams(window.location.search),a=r.get("dev"),l=a?`//${window.location.host}/dev-only/${a}.json`:void 0;t(0,s=l||(r.get("path")??yt))}),[s]}class Es extends R{constructor(e){super(),W(this,e,gs,_s,z,{})}}export{Es as component};
