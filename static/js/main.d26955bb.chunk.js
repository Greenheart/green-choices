(this.webpackJsonpswipeforfuture=this.webpackJsonpswipeforfuture||[]).push([[0],{28:function(t,e,n){"use strict";var r,a=n(6),i=n.n(a),o=n(10),c=n(3),s=n(20),d=n(2),u=n(5),l=n(1),f=n(4);function h(t){return function(e){return(0,e.theme.cardWidth)(t)}}!function(t){t[t.Left=-1]="Left",t[t.Right=1]="Right"}(r||(r={}));var v=h(.035),b=h(1),p=h(2),g=h(.5),j=h(.25),x=h(.125),m=h(.0625),w=h(.1),y=h(.05),O=h(.025),k=h(.0125),S=h(-.1125),_=u.b.div.withConfig({displayName:"CardView__CardContent",componentId:"sc-17kx3at-0"})(["font-size:",";& > .action-left,& > .action-right{font-size:160%;background:#fff;position:absolute;overflow:hidden;top:20%;max-width:",";min-width:",";padding:0;opacity:0;transition:transform 0.2s,opacity 0.2s;transform:translateX(0%) scale(0.7);box-shadow:0 12.5px 20px -10px rgba(50,50,73,0.4),0 10px 10px -10px rgba(50,50,73,0.3);& > .description{padding:",";text-align:center;}& > .arrow{background:#333;font-size:160%;color:#fff;padding-left:",";padding-right:",";}}& > .action-right{left:0;border-radius:",";& > .arrow{text-align:right;}}& > .action-left{right:0;border-radius:",";}& > .action-right.active{transform:translateX(-50%) scale(1);opacity:1;}& > .action-left.active{transform:translateX(50%) scale(1);opacity:1;}& > .card-view{display:block;will-change:transform;position:relative;width:",";height:",";border-radius:",";box-shadow:0 12.5px 20px -10px rgba(50,50,73,0.4),0 10px 10px -10px rgba(50,50,73,0.3);overflow:hidden;background:#fff;& > .card-image{width:100%;height:70%;background-repeat:no-repeat;background-position:center center;background-size:auto 120%;border:solid "," #fff;border-style:solid solid none solid;}& > .card-text{position:absolute;bottom:0;left:0;width:100%;min-height:30%;background:#fff;& > em.location{position:absolute;top:",";right:0;display:block;font-size:140%;background:rgba(230,230,230,0.7);border-radius:1vh 0 0 1vh;padding:"," "," "," ",";}& > h1.title{font-size:160%;white-space:nowrap;color:#fff;background:#333;display:block;margin:0;padding:"," ",";}& > p.text{font-size:160%;color:#333;padding:"," "," "," ",";margin:0;}}& > .card-back{width:100%;height:100%;border:solid "," #fff;box-sizing:border-box;background:url(",");background-size:auto 100%;background-repeat:repeat;background-position:center center;}}"],v,g,j,O,O,O,v,v,b,p,v,v,S,k,x,k,y,O,m,y,m,w,m,v,(function(t){return t.theme.cardBackImage}));_.defaultProps={theme:{cardWidth:function(t){return 40*t+"vh"},cardBackImage:"https://images.unsplash.com/photo-1550537687-c91072c4792d?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=800&q=80"}};var E=function(t){var e=t.image,n=t.title,a=t.text,i=t.location,o=t.leftAction,c=t.rightAction,s=t.direction;return Object(d.jsxs)(_,{children:[Object(d.jsxs)("div",{className:"card-view",children:[Object(d.jsx)("div",{className:"card-image",style:{backgroundImage:"url("+(e||"")+")"}}),Object(d.jsxs)("div",{className:"card-text",children:[i&&Object(d.jsx)("em",{className:"location",children:i}),Object(d.jsx)("h1",{className:"title",children:n}),Object(d.jsx)("p",{className:"text",children:a})]})]}),Object(d.jsxs)("div",{className:"action-left"+(s===r.Left?" active":""),children:[Object(d.jsx)("div",{className:"description",children:null!==o&&void 0!==o?o:"No"}),Object(d.jsx)("div",{className:"arrow",children:"\u2190"})]}),Object(d.jsxs)("div",{className:"action-right"+(s===r.Right?" active":""),children:[Object(d.jsx)("div",{className:"description",children:null!==c&&void 0!==c?c:"Yes"}),Object(d.jsx)("div",{className:"arrow",children:"\u2192"})]})]})},C=function(t){var e=t.x,n=t.y,r=t.r,a=void 0===r?0:r,i=t.layer;return Object(d.jsx)("div",{style:{position:"absolute",left:"50%",transform:"translate3d(-50%, 0, 0) translate3d(".concat(.15*e,"vh, ").concat(.15*n,"vh, 0) perspective(1500px) rotate3d(1, 0, 0, 30deg) rotate3d(0, 0, 1, ").concat(a,"deg)"),transition:"transform 0.3s",zIndex:i},children:Object(d.jsx)(_,{children:Object(d.jsx)("div",{className:"card-view",children:Object(d.jsx)("div",{className:"card-back"})})})})},N=n(13),I=n(24),A=function(){return Math.min(200,window.innerWidth/2)},W=function(t){var e,n,a=t.i,i=t.cardData,o=t.onSwipe,s=t.layer,u=i.title,h=i.location,v=i.text,b=i.image,p=i.actions,g=Object(N.c)((function(){return Object(f.a)(Object(f.a)({},function(t){return{x:0,y:-30,scale:1,rot:0,delay:100*t}}(a)),{},{from:{rot:0,scale:1,y:-20,x:0}})})),j=Object(c.a)(g,2),x=j[0],m=j[1],w=Object(l.useState)(0),y=Object(c.a)(w,2),O=y[0],k=y[1],S=Object(l.useState)({isGone:!1,currentKey:null}),_=Object(c.a)(S,1)[0],C=function(t){Object(c.a)(t.args,1)[0];var e=t.down,n=Object(c.a)(t.delta,1)[0],r=(t.distance,Object(c.a)(t.direction,1)[0],t.velocity),a=Math.abs(n)*window.devicePixelRatio>A(),s=Math.sign(n);e||!a||_.isGone||(_.isGone=!0,window.setTimeout((function(){o(i,s),_.currentKey=null}),200)),k(e?s:0);var d=_.isGone,u=d?(200+window.innerWidth)*s:e?n:0;m({x:u,rot:n/100+(d?10*s*r:0),scale:e?1.1:1,delay:void 0,config:{friction:50,tension:e?800:d?200:500}})};e=["ArrowLeft","ArrowRight"],n=function(t,e){if(t&&!_.currentKey&&(_.currentKey=e),_.currentKey===e){var n="ArrowLeft"===e?r.Left:r.Right;C({down:t,delta:[n*(A()/window.devicePixelRatio+1),0],direction:[n,0],args:[0],distance:0,velocity:5})}},Object(l.useEffect)((function(){var t=function(t){e.includes(t.key)&&n(!0,t.key)},r=function(t){e.includes(t.key)&&n(!1,t.key)};return window.addEventListener("keydown",t),window.addEventListener("keyup",r),function(){window.removeEventListener("keydown",t),window.removeEventListener("keyup",r)}}));var W=Object(I.a)((function(t){_.currentKey||C(t)})),M=x.x,R=x.y,L=x.rot,F=x.scale;return Object(l.createElement)(N.a.div,Object(f.a)(Object(f.a)({},W(a)),{},{key:a,style:{position:"absolute",left:"50%",transform:Object(N.b)([M,R,L,F],(function(t,e,n,r){return"translate3d(-50%, 0, 0) translate3d(".concat(.15*t,"vh,").concat(.15*e,"vh,0) ")+(a=n,i=Number(r),"perspective(1500px) rotate3d(1, 0, 0, 30deg) rotate3d(0, 0, 1, ".concat(a,"deg) scale(").concat(i,")"));var a,i})),zIndex:s}}),Object(d.jsx)(E,{image:b,title:u,text:v,location:h,leftAction:p.left.description,rightAction:p.right.description,direction:O}))};function M(t,e,n){return(e+t-n%e)%e}var R=function(t){var e=t.onSwipe,n=t.card,r=t.tick,a=void 0===r?0:r,i=Array.apply(null,Array(5)).map((function(t,e){return e}));return Object(d.jsxs)("div",{className:"deck-root",children:[i.map((function(t,e,n){return Object(d.jsx)(C,{x:0,y:n[M(e,n.length,a)]*(50/n.length)-20,r:1*Math.sin(2345*t),layer:n.length-M(e,n.length,a)},e)})),Object(d.jsx)(W,{i:0,cardData:n,onSwipe:e,layer:i.length+1},n.id)]})},L=n(26),F=n(25),z=n(27),P=u.b.div.withConfig({displayName:"Bar__Container",componentId:"sc-1d2had3-0"})(["width:5vh;height:1vh;background:#333;box-shadow:0 0.2vh 0.2vh rgba(0,0,0,0.2);"]),D=u.b.div.withConfig({displayName:"Bar__Value",componentId:"sc-1d2had3-1"})(["width:",";position:relative;height:100%;background:#fff;"],(function(t){return t.value+"%"})),T=function(t){var e=t.value,n=void 0===e?100:e;return Object(d.jsx)(P,{children:Object(d.jsx)(D,{value:n})})},K=u.b.header.withConfig({displayName:"Stats__Container",componentId:"e1jx7a-0"})(["background:#66aa55;display:flex;flex-direction:row;justify-content:center;align-items:center;flex-basis:10vh;flex-grow:0;flex-shrink:0;border-bottom:solid 0.5vh #fff;box-shadow:0 0.2vh 0.5vh rgba(0,0,0,0.5);"]),U=u.b.div.withConfig({displayName:"Stats__Stat",componentId:"e1jx7a-1"})(["display:flex;justify-content:space-between;align-items:center;flex-direction:column;margin-right:3.5vh;&:last-child{margin-right:0;}"]),B=u.b.div.withConfig({displayName:"Stats__Icon",componentId:"e1jx7a-2"})(["width:5vh;height:5vh;border-radius:50% 0;background:#fff;display:flex;justify-content:center;align-items:center;box-shadow:0 0.3vh 0.3vh rgba(0,0,0,0.2);margin-bottom:1vh;"]),Q=function(t){var e=t.stats;return Object(d.jsx)(K,{children:e.map((function(t){var e=t.icon,n=t.icon,r=t.icon,a=F[e]||L[n]||z[r],i=t.iconSize||"80%",o=t.value;return Object(d.jsxs)(U,{children:[Object(d.jsx)(B,{children:a&&Object(d.jsx)(a,{size:i})}),Object(d.jsx)(T,{value:o})]},t.id)}))})},G=u.b.footer.withConfig({displayName:"Game__Footer",componentId:"kxsm7q-0"})(["display:flex;justify-content:center;align-items:center;"]);var H=function(t){var e=t.scenario,n=Object(l.useState)((function(){return e.getInitialState()})),a=Object(c.a)(n,2),i=a[0],o=a[1],s=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Object(f.a)(Object(f.a)({},t),{},{id:Date.now()+":"+e})}(i.card),u=i.world.state,h=e.stats.map((function(t){return Object.assign({},t,{value:u[t.id]})}));return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)(Q,{stats:h}),Object(d.jsx)(R,{onSwipe:function(t,n){var a=n===r.Left?t.actions.left:t.actions.right;o(e.getUpdatedState(i,t,a))},card:s,tick:i.rounds}),Object(d.jsx)(G,{children:Object(d.jsx)("div",{className:"time-remaining"})})]})},J=n(7),V=n(9),X=n(8),q=function(t){var e;return{state:Object(f.a)(Object(f.a)({},t.state),{},{rounds:(null!==(e=t.state.rounds)&&void 0!==e?e:0)+1}),flags:t.flags}};function Y(t,e,n,r){return function(a){var i=e.map((function(t){var e;return null!==(e=a.state[t])&&void 0!==e?e:0})),o=r?i.reduce((function(t,e){return n(t,e)}),r):i.reduce((function(t,e){return n(t,e)}));return{state:Object(f.a)(Object(f.a)({},a.state),{},Object(X.a)({},t,o)),flags:a.flags}}}function Z(t){return t.map((function(t){switch(t.type){case"round":return q;case"cycle":return r=t.id,a=t.length,function(t){var e;return{state:Object(f.a)(Object(f.a)({},t.state),{},Object(X.a)({},r,((null!==(e=t.state[r])&&void 0!==e?e:0)+1)%a)),flags:t.flags}};case"min":return Y(t.targetId,t.sourceIds,(function(t,e){return Math.min(t,e)}));case"max":return Y(t.targetId,t.sourceIds,(function(t,e){return Math.max(t,e)}));case"sum":return Y(t.targetId,t.sourceIds,(function(t,e){return t+e}),0);case"debug":return e=t.stateIds,n=t.flagIds,function(t){var r=void 0===e?t.state:e.reduce((function(e,n){return e[n]=t.state[n],e}),{}),a=void 0===n?t.flags:n.reduce((function(e,n){return e[n]=t.flags[n],e}),{});return Object.keys(r).length>0&&console.table(r),Object.keys(a).length>0&&console.table(a),t};default:throw new Error("Missing modifier type: "+t.type)}var e,n,r,a}))}var $=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(J.a)(this,t),this._scenario=void 0,this._random=void 0,this._worldStateExtensions=void 0;var r=n.random,a=void 0===r?Math.random:r,i=n.worldStateExtensions,o=void 0===i?[]:i;this._scenario=e,this._random=a,this._worldStateExtensions=o}return Object(V.a)(t,[{key:"getInitialState",value:function(){return{world:this.applyWorldStateExtensions(this._worldStateExtensions,this._scenario.defaultState),card:this.getInitialCard(),rounds:0}}},{key:"getUpdatedState",value:function(t,e,n){var r=this.getUpdatedWorld(n.modifier,t.world);return{world:r,card:this.getNextCard(r,e,n),rounds:t.rounds+1}}},{key:"getUpdatedWorld",value:function(t,e){var n=Object(f.a)({type:"add",state:{},flags:{}},t),r=this.updateWorldState(n,e),a=this.updateWorldFlags(n,e);return this.applyWorldStateExtensions(this._worldStateExtensions,{state:r,flags:a})}},{key:"updateWorldState",value:function(t,e){var n="replace"===t.type?Object.assign({},this._scenario.defaultState.state):Object.assign({},e.state),r=t.state||{};return Object.entries(r).reduce((function(e,n){var r=Object(c.a)(n,2),a=r[0],i=r[1],o="set"===t.type||"replace"===t.type?i:i+(e[a]||0);return e[a]=Math.min(Math.max(o,0),100),e}),n)}},{key:"updateWorldFlags",value:function(t,e){var n="replace"===t.type?Object.assign({},this._scenario.defaultState.flags):Object.assign({},e.flags),r=t.flags||{};return Object.entries(r).reduce((function(t,e){var n=Object(c.a)(e,2),r=n[0],a=n[1];return t[r]=a,t}),n)}},{key:"applyWorldStateExtensions",value:function(t,e){return t.reduce((function(t,e){return e(t)}),e)}},{key:"getInitialCard",value:function(){var t=this.getAvailableEvents(this._scenario.defaultState),e=this.selectNextEvent(t);return e?this.selectEventCard(e.initialEventCardId):this.selectNextCard(this.getAvailableCards(this._scenario.defaultState))}},{key:"getNextCard",value:function(t,e,n){var r,a=this._scenario.eventCards,i=this.getAvailableEvents(t),o=[],c="event"===e.type&&"nextEventCardId"in n?n.nextEventCardId:null,s=c?null:this.selectNextEvent(i);if(c){if(!a.hasOwnProperty(c))throw new Error('eventCardId "'.concat(c,"\" does not exist. Make sure it's spelled correctly"));r=this.selectEventCard(c)}else s?r=this.selectEventCard(s.initialEventCardId):(o=this.getAvailableCards(t),r=this.selectNextCard(o));if(!r)throw new Error("Content error. No next card available.");return r}},{key:"getAvailableEvents",value:function(t){var e=this;return this._scenario.events.filter((function(n){return e.hasMatchingWorldQuery(t,n.isAvailableWhen)}))}},{key:"getAvailableCards",value:function(t){var e=this;return this._scenario.cards.filter((function(n){return e.hasMatchingWorldQuery(t,n.isAvailableWhen)}))}},{key:"hasMatchingWorldQuery",value:function(t,e){var n=this;return e.some((function(e){return n.isMatchingWorldQuery(t,e)}))}},{key:"isMatchingWorldQuery",value:function(t,e){var n=e.state,r=void 0===n?{}:n,a=e.flags,i=void 0===a?{}:a;return Object.entries(r).every((function(e){var n=Object(c.a)(e,2),r=n[0],a=Object(c.a)(n[1],2),i=a[0],o=a[1];return t.state[r]>=i&&t.state[r]<=o}))&&Object.entries(i).every((function(e){var n=Object(c.a)(e,2),r=n[0],a=n[1];return!!t.flags[r]===a}))}},{key:"selectNextEvent",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=this.selectRandomFrom(t);if(e&&this._random()<=e.probability)return e}},{key:"selectEventCard",value:function(t){var e=this._scenario.eventCards[t];if(!e)throw new Error('ContentError: EventCard with EventCardId "'.concat(t,'" does not exist'));return e}},{key:"selectRandomFrom",value:function(t){return t[Math.floor(this._random()*t.length)]}},{key:"selectNextCard",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.selectWeightedRandomFrom(t)}},{key:"selectWeightedRandomFrom",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(t){return t.weight},n=t.reduce((function(t,n){return t.count+=e(n),t.selectionList.push(t.count),t}),{count:0,selectionList:[]}),r=n.selectionList,a=n.count,i=this._random()*a,o=r.findIndex((function(t,e,n){var r=e>0?n[e-1]:0;return i>=r&&i<=t}));return t[o]}},{key:"stats",get:function(){return this._scenario.stats}}],[{key:"fromData",value:function(e){return new t(e,{worldStateExtensions:Z(e.worldStateModifiers)})}}]),t}();function tt(t){return et.apply(this,arguments)}function et(){return(et=Object(o.a)(i.a.mark((function t(e){var n,r,a,o,c,s;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n=e.match(/^local:\/\/(.*)/))){t.next=10;break}if(r=n[1],a="game_world:"+r,o={stats:[],cards:[],events:[],eventCards:{},defaultState:{state:{},flags:{}},worldStateModifiers:[]},c=localStorage.getItem(a),s=c?JSON.parse(c):null){t.next=9;break}throw new Error("Could not load data from local storage: "+a);case 9:return t.abrupt("return",Object.assign(o,s));case 10:return t.abrupt("return",null);case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function nt(t){return rt.apply(this,arguments)}function rt(){return(rt=Object(o.a)(i.a.mark((function t(e){var n,r,a,o,s,d,u,l,f,h,v,b,p,g;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e+"/stats.json",r=e+"/cards.json",a=e+"/events.json",o=e+"/event-cards.json",s=e+"/default-state.json",d=e+"/modifiers.json",t.next=8,Promise.all([ot(n),ot(r),ot(a),ot(o),ot(s),ot(d)]);case 8:return u=t.sent,l=Object(c.a)(u,6),f=l[0],h=l[1],v=l[2],b=l[3],p=l[4],g=l[5],t.abrupt("return",{stats:f,cards:h,events:v,eventCards:b,defaultState:p,worldStateModifiers:g});case 17:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function at(t){return it.apply(this,arguments)}function it(){return(it=Object(o.a)(i.a.mark((function t(e){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,tt(e);case 2:if(t.t0=t.sent,t.t0){t.next=7;break}return t.next=6,nt(e);case 6:t.t0=t.sent;case 7:return t.abrupt("return",t.t0);case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function ot(t){return ct.apply(this,arguments)}function ct(){return(ct=Object(o.a)(i.a.mark((function t(e){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("fetching path: ",e),t.next=3,window.fetch(e);case 3:return t.next=5,t.sent.json();case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function st(){var t=Object(s.a)(["\n    * {\n        box-sizing: border-box;\n    }\n\n    html,\n    body {\n        margin: 0;\n        padding: 0;\n        height: 100%;\n        width: 100%;\n        user-select: none;\n        position: fixed;\n        overflow: hidden;\n    }\n"]);return st=function(){return t},t}var dt=u.b.main.withConfig({displayName:"App__Container",componentId:"sc-1p3585w-0"})(["position:absolute;top:0;left:0;width:100vw;height:100%;background:#ccdddd;display:flex;flex-direction:column;"]),ut=Object(u.a)(st());e.a=function(t){var e=t.path,n=Object(l.useState)(null),r=Object(c.a)(n,2),a=r[0],s=r[1];return Object(l.useEffect)((function(){(function(){var t=Object(o.a)(i.a.mark((function t(){var n,r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,at(e);case 2:(n=t.sent)?(r=$.fromData(n),s(r)):console.warn("Scenario loading error");case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}})()()}),[e,s]),Object(d.jsxs)(dt,{children:[Object(d.jsx)(ut,{}),a&&Object(d.jsx)(H,{scenario:a})]})}},29:function(t,e,n){"use strict";n.r(e),function(t){var e,r,a=n(2),i=(n(1),n(19)),o=n.n(i),c=(n(35),n(28)),s=new URLSearchParams(window.location.search).get("path")||(null===(e=t)||void 0===e||null===(r=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SFF_DEFAULT_SCENARIO:"/data/scenarios/default"}))||void 0===r?void 0:r.REACT_APP_SFF_DEFAULT_SCENARIO)||"/data/default";o.a.render(Object(a.jsx)(c.a,{path:s}),document.getElementById("root"))}.call(this,n(18))},35:function(t,e,n){}},[[29,1,2]]]);
//# sourceMappingURL=main.d26955bb.chunk.js.map