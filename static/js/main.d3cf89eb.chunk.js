(this.webpackJsonpswipeforfuture=this.webpackJsonpswipeforfuture||[]).push([[0],{27:function(e,t,n){"use strict";var a,r=n(5),i=n.n(r),o=n(9),c=n(2),s=n(19),l=n(3),d=n(1),u=n.n(d),f=n(4);function p(e){return function(t){return(0,t.theme.cardWidth)(e)}}!function(e){e[e.Left=-1]="Left",e[e.Right=1]="Right"}(a||(a={}));var v=p(.035),h=p(1),g=p(2),m=p(.5),b=p(.25),w=p(.125),y=p(.0625),x=p(.1),E=p(.05),k=p(.025),j=p(.0125),O=p(-.1125),_=l.b.div.withConfig({displayName:"CardView__CardContent",componentId:"sc-17kx3at-0"})(["font-size:",";& > .action-left,& > .action-right{font-size:160%;background:#fff;position:absolute;overflow:hidden;top:20%;max-width:",";min-width:",";padding:0;opacity:0;transition:transform 0.2s,opacity 0.2s;transform:translateX(0%) scale(0.7);box-shadow:0 12.5px 20px -10px rgba(50,50,73,0.4),0 10px 10px -10px rgba(50,50,73,0.3);& > .description{padding:",";text-align:center;}& > .arrow{background:#333;font-size:160%;color:#fff;padding-left:",";padding-right:",";}}& > .action-right{left:0;border-radius:",";& > .arrow{text-align:right;}}& > .action-left{right:0;border-radius:",";}& > .action-right.active{transform:translateX(-50%) scale(1);opacity:1;}& > .action-left.active{transform:translateX(50%) scale(1);opacity:1;}& > .card-view{display:block;will-change:transform;position:relative;width:",";height:",";border-radius:",";box-shadow:0 12.5px 20px -10px rgba(50,50,73,0.4),0 10px 10px -10px rgba(50,50,73,0.3);overflow:hidden;background:#fff;& > .card-image{width:100%;height:70%;background-repeat:no-repeat;background-position:center center;background-size:auto 120%;border:solid "," #fff;border-style:solid solid none solid;}& > .card-text{position:absolute;bottom:0;left:0;width:100%;min-height:30%;background:#fff;& > em.location{position:absolute;top:",";right:0;display:block;font-size:140%;background:rgba(230,230,230,0.7);border-radius:1vh 0 0 1vh;padding:"," "," "," ",";}& > h1.title{font-size:160%;white-space:nowrap;color:#fff;background:#333;display:block;margin:0;padding:"," ",";}& > p.text{font-size:160%;color:#333;padding:"," "," "," ",";margin:0;}}& > .card-back{width:100%;height:100%;border:solid "," #fff;box-sizing:border-box;background:url(",");background-size:auto 100%;background-repeat:repeat;background-position:center center;}}"],v,m,b,k,k,k,v,v,h,g,v,v,O,j,w,j,E,k,y,E,y,x,y,v,(function(e){return e.theme.cardBackImage}));_.defaultProps={theme:{cardWidth:function(e){return 40*e+"vh"},cardBackImage:"https://images.unsplash.com/photo-1550537687-c91072c4792d?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=800&q=80"}};var C=function(e){var t=e.image,n=e.title,r=e.text,i=e.location,o=e.leftAction,c=e.rightAction,s=e.direction;return u.a.createElement(_,null,u.a.createElement("div",{className:"card-view"},u.a.createElement("div",{className:"card-image",style:{backgroundImage:"url("+(t||"")+")"}}),u.a.createElement("div",{className:"card-text"},i&&u.a.createElement("em",{className:"location"},i),u.a.createElement("h1",{className:"title"},n),u.a.createElement("p",{className:"text"},r))),u.a.createElement("div",{className:"action-left"+(s===a.Left?" active":"")},u.a.createElement("div",{className:"description"},null!==o&&void 0!==o?o:"No"),u.a.createElement("div",{className:"arrow"},"\u2190")),u.a.createElement("div",{className:"action-right"+(s===a.Right?" active":"")},u.a.createElement("div",{className:"description"},null!==c&&void 0!==c?c:"Yes"),u.a.createElement("div",{className:"arrow"},"\u2192")))},S=function(e){var t=e.x,n=e.y,a=e.r,r=void 0===a?0:a,i=e.layer;return u.a.createElement("div",{style:{position:"absolute",left:"50%",transform:"translate3d(-50%, 0, 0) translate3d(".concat(t,"px, ").concat(n,"px, 0) perspective(1500px) rotate3d(1, 0, 0, 30deg) rotate3d(0, 0, 1, ").concat(r,"deg)"),transition:"transform 0.3s",zIndex:i}},u.a.createElement(_,null,u.a.createElement("div",{className:"card-view"},u.a.createElement("div",{className:"card-back"}))))},N=n(12),I=n(23),A=function(){return Math.min(200,window.innerWidth/2)},W=function(e){var t,n,r=e.i,i=e.cardData,o=e.onSwipe,s=e.layer,l=i.title,p=i.location,v=i.text,h=i.image,g=i.actions,m=Object(N.c)((function(){return Object(f.a)(Object(f.a)({},function(e){return{x:0,y:0,scale:1,rot:0,delay:100*e}}(r)),{},{from:{rot:0,scale:1,y:10,x:0}})})),b=Object(c.a)(m,2),w=b[0],y=b[1],x=Object(d.useState)(0),E=Object(c.a)(x,2),k=E[0],j=E[1],O=Object(d.useState)({isGone:!1,currentKey:null}),_=Object(c.a)(O,1)[0],S=function(e){Object(c.a)(e.args,1)[0];var t=e.down,n=Object(c.a)(e.delta,1)[0],a=(e.distance,Object(c.a)(e.direction,1)[0],e.velocity),r=Math.abs(n)*window.devicePixelRatio>A(),s=Math.sign(n);t||!r||_.isGone||(_.isGone=!0,window.setTimeout((function(){o(i,s),_.currentKey=null}),200)),j(t&&r?s:0);var l=_.isGone,d=l?(200+window.innerWidth)*s:t?n:0;y({x:d,rot:n/100+(l?10*s*a:0),scale:t?1.1:1,delay:void 0,config:{friction:50,tension:t?800:l?200:500}})};t=["ArrowLeft","ArrowRight"],n=function(e,t){if(e&&!_.currentKey&&(_.currentKey=t),_.currentKey===t){var n="ArrowLeft"===t?a.Left:a.Right;S({down:e,delta:[n*(A()/window.devicePixelRatio+1),0],direction:[n,0],args:[0],distance:0,velocity:5})}},Object(d.useEffect)((function(){var e=function(e){t.includes(e.key)&&n(!0,e.key)},a=function(e){t.includes(e.key)&&n(!1,e.key)};return window.addEventListener("keydown",e),window.addEventListener("keyup",a),function(){window.removeEventListener("keydown",e),window.removeEventListener("keyup",a)}}));var W=Object(I.a)((function(e){_.currentKey||S(e)})),L=w.x,M=w.y,R=w.rot,z=w.scale;return u.a.createElement(N.a.div,Object.assign({},W(r),{key:r,style:{position:"absolute",left:"50%",transform:Object(N.b)([L,M,R,z],(function(e,t,n,a){return"translate3d(-50%, 0, 0) translate3d(".concat(e,"px,").concat(t,"px,0) ")+(r=n,i=Number(a),"perspective(1500px) rotate3d(1, 0, 0, 30deg) rotate3d(0, 0, 1, ".concat(r,"deg) scale(").concat(i,")"));var r,i})),zIndex:s}}),u.a.createElement(C,{image:h,title:l,text:v,location:p,leftAction:g.left.description,rightAction:g.right.description,direction:k}))};function L(e,t,n){return(t+e-n%t)%t}var M=function(e){var t=e.onSwipe,n=e.card,a=e.tick,r=void 0===a?0:a,i=Array.apply(null,Array(5)).map((function(e,t){return t}));return u.a.createElement("div",{className:"deck-root"},i.map((function(e,t,n){return u.a.createElement(S,{x:0,y:10+n[L(t,n.length,r)]*(50/n.length),key:t,r:1*Math.sin(2345*e),layer:n.length-L(t,n.length,r)})})),u.a.createElement(W,{i:0,key:n.id,cardData:n,onSwipe:t,layer:i.length+1}))},R=n(25),z=n(24),F=n(26),P=l.b.div.withConfig({displayName:"Bar__Container",componentId:"sc-1d2had3-0"})(["margin-top:10px;width:40px;height:8px;border-radius:4px;background:#546a76;"]),D=l.b.div.withConfig({displayName:"Bar__Value",componentId:"sc-1d2had3-1"})(["position:relative;top:1px;left:1px;height:6px;max-width:38px;border-radius:3px;"]);function T(e){return e<=30?"#dd7373":e<=70?"#e7e247":"#91c779"}var K=function(e){var t=e.value,n=void 0===t?100:t;return u.a.createElement(P,null,u.a.createElement(D,{style:{width:"".concat(n,"%"),backgroundColor:T(n)}}))},U=l.b.header.withConfig({displayName:"Stats__Container",componentId:"e1jx7a-0"})(["background:#f6fbf5;display:flex;flex-direction:row;justify-content:space-evenly;align-items:center;"]),B=l.b.div.withConfig({displayName:"Stats__Stat",componentId:"e1jx7a-1"})(["display:flex;justify-content:space-between;align-items:center;flex-direction:column;"]),Q=l.b.div.withConfig({displayName:"Stats__Icon",componentId:"e1jx7a-2"})(["width:40px;height:40px;border-radius:50%;background:#91c779;display:flex;justify-content:center;align-items:center;"]),G=function(e){var t=e.stats;return u.a.createElement(U,null,t.map((function(e){var t=e.icon,n=e.icon,a=e.icon,r=z[t]||R[n]||F[a],i=e.iconSize||"80%",o=e.value;return u.a.createElement(B,{key:e.id},u.a.createElement(Q,null,r&&u.a.createElement(r,{size:i})),u.a.createElement(K,{value:o}))})))},J=l.b.footer.withConfig({displayName:"Game__Footer",componentId:"kxsm7q-0"})(["display:flex;justify-content:center;align-items:center;"]);var H=function(e){var t=e.scenario,n=Object(d.useState)(t.getInitialState()),r=Object(c.a)(n,2),i=r[0],o=r[1],s=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Object(f.a)(Object(f.a)({},e),{},{id:Date.now()+":"+t})}(i.card),l=i.world.state,p=t.stats.map((function(e){return Object.assign({},e,{value:l[e.id]})}));return u.a.createElement(u.a.Fragment,null,u.a.createElement(G,{stats:p}),u.a.createElement(M,{onSwipe:function(e,n){var r=n===a.Left?e.actions.left:e.actions.right;o(t.getUpdatedState(i,e,r))},card:s,tick:i.rounds}),u.a.createElement(J,null,u.a.createElement("div",{className:"time-remaining"})))},V=n(6),X=n(8),q=n(7),Y=function(e){var t;return{state:Object(f.a)(Object(f.a)({},e.state),{},{rounds:(null!==(t=e.state.rounds)&&void 0!==t?t:0)+1}),flags:e.flags}};var Z=function(e){return console.table(e.state),console.table(e.flags),e};function $(e){return e.map((function(e){switch(e.type){case"round":return Y;case"cycle":return t=e.id,n=e.length,function(e){var a;return{state:Object(f.a)(Object(f.a)({},e.state),{},Object(q.a)({},t,((null!==(a=e.state[t])&&void 0!==a?a:0)+1)%n)),flags:e.flags}};case"debug":return Z;default:throw new Error("Missing modifier type: "+e.type)}var t,n}))}var ee=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(V.a)(this,e),this._scenario=void 0,this._random=void 0,this._worldStateExtensions=void 0;var a=n.random,r=void 0===a?Math.random:a,i=n.worldStateExtensions,o=void 0===i?[]:i;this._scenario=t,this._random=r,this._worldStateExtensions=o}return Object(X.a)(e,[{key:"getInitialState",value:function(){return{world:this._scenario.defaultState,card:this.getInitialCard(),rounds:0}}},{key:"getUpdatedState",value:function(e,t,n){var a=this.getUpdatedWorld(n.modifier,e.world);return{world:a,card:this.getNextCard(a,t,n),rounds:e.rounds+1}}},{key:"getUpdatedWorld",value:function(e,t){var n=Object(f.a)({type:"add",state:{},flags:{}},e),a=this.updateWorldState(n,t),r=this.updateWorldFlags(n,t);return this.applyWorldStateExtensions(this._worldStateExtensions,{state:a,flags:r})}},{key:"updateWorldState",value:function(e,t){var n="replace"===e.type?Object.assign({},this._scenario.defaultState.state):Object.assign({},t.state),a=e.state||{};return Object.entries(a).reduce((function(t,n){var a=Object(c.a)(n,2),r=a[0],i=a[1],o="set"===e.type||"replace"===e.type?i:i+(t[r]||0);return t[r]=Math.min(Math.max(o,0),100),t}),n)}},{key:"updateWorldFlags",value:function(e,t){var n="replace"===e.type?Object.assign({},this._scenario.defaultState.flags):Object.assign({},t.flags),a=e.flags||{};return Object.entries(a).reduce((function(e,t){var n=Object(c.a)(t,2),a=n[0],r=n[1];return e[a]=r,e}),n)}},{key:"applyWorldStateExtensions",value:function(e,t){return e.reduce((function(e,t){return t(e)}),t)}},{key:"getInitialCard",value:function(){var e=this.getAvailableEvents(this._scenario.defaultState),t=this.selectNextEvent(e);return t?this.selectEventCard(t.initialEventCardId):this.selectNextCard(this.getAvailableCards(this._scenario.defaultState))}},{key:"getNextCard",value:function(e,t,n){var a,r=this._scenario.eventCards,i=this.getAvailableEvents(e),o=[],c="event"===t.type&&"nextEventCardId"in n?n.nextEventCardId:null,s=c?null:this.selectNextEvent(i);if(c){if(!r.hasOwnProperty(c))throw new Error('eventCardId "'.concat(c,"\" does not exist. Make sure it's spelled correctly"));a=this.selectEventCard(c)}else s?a=this.selectEventCard(s.initialEventCardId):(o=this.getAvailableCards(e),a=this.selectNextCard(o));if(!a)throw new Error("Content error. No next card available.");return a}},{key:"getAvailableEvents",value:function(e){var t=this;return this._scenario.events.filter((function(n){return t.hasMatchingWorldQuery(e,n.isAvailableWhen)}))}},{key:"getAvailableCards",value:function(e){var t=this;return this._scenario.cards.filter((function(n){return t.hasMatchingWorldQuery(e,n.isAvailableWhen)}))}},{key:"hasMatchingWorldQuery",value:function(e,t){var n=this;return t.some((function(t){return n.isMatchingWorldQuery(e,t)}))}},{key:"isMatchingWorldQuery",value:function(e,t){var n=t.state,a=void 0===n?{}:n,r=t.flags,i=void 0===r?{}:r;return Object.entries(a).every((function(t){var n=Object(c.a)(t,2),a=n[0],r=Object(c.a)(n[1],2),i=r[0],o=r[1];return e.state[a]>=i&&e.state[a]<=o}))&&Object.entries(i).every((function(t){var n=Object(c.a)(t,2),a=n[0],r=n[1];return e.flags[a]===r}))}},{key:"selectNextEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=this.selectRandomFrom(e);if(t&&this._random()<=t.probability)return t}},{key:"selectEventCard",value:function(e){var t=this._scenario.eventCards[e];if(!t)throw new Error('ContentError: EventCard with EventCardId "'.concat(e,'" does not exist'));return t}},{key:"selectRandomFrom",value:function(e){return e[Math.floor(this._random()*e.length)]}},{key:"selectNextCard",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.selectWeightedRandomFrom(e)}},{key:"selectWeightedRandomFrom",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return e.weight},n=e.reduce((function(e,n){return e.count+=t(n),e.selectionList.push(e.count),e}),{count:0,selectionList:[]}),a=n.selectionList,r=n.count,i=this._random()*r,o=a.findIndex((function(e,t,n){var a=t>0?n[t-1]:0;return i>=a&&i<=e}));return e[o]}},{key:"stats",get:function(){return this._scenario.stats}}],[{key:"fromData",value:function(t){return new e(t,{worldStateExtensions:$(t.worldStateModifiers)})}}]),e}();function te(e){return ne.apply(this,arguments)}function ne(){return(ne=Object(o.a)(i.a.mark((function e(t){var n,a,r,o,c,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=t.match(/^local:\/\/(.*)/))){e.next=10;break}if(a=n[1],r="game_world:"+a,o={stats:[],cards:[],events:[],eventCards:{},defaultState:{state:{},flags:{}},worldStateModifiers:[]},c=localStorage.getItem(r),s=c?JSON.parse(c):null){e.next=9;break}throw new Error("Could not load data from local storage: "+r);case 9:return e.abrupt("return",Object.assign(o,s));case 10:return e.abrupt("return",null);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ae(e){return re.apply(this,arguments)}function re(){return(re=Object(o.a)(i.a.mark((function e(t){var n,a,r,o,s,l,d,u,f,p,v,h,g,m;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t+"/stats.json",a=t+"/cards.json",r=t+"/events.json",o=t+"/event-cards.json",s=t+"/default-state.json",l=t+"/modifiers.json",e.next=8,Promise.all([ce(n),ce(a),ce(r),ce(o),ce(s),ce(l)]);case 8:return d=e.sent,u=Object(c.a)(d,6),f=u[0],p=u[1],v=u[2],h=u[3],g=u[4],m=u[5],e.abrupt("return",{stats:f,cards:p,events:v,eventCards:h,defaultState:g,worldStateModifiers:m});case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ie(e){return oe.apply(this,arguments)}function oe(){return(oe=Object(o.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,te(t);case 2:if(e.t0=e.sent,e.t0){e.next=7;break}return e.next=6,ae(t);case 6:e.t0=e.sent;case 7:return e.abrupt("return",e.t0);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ce(e){return se.apply(this,arguments)}function se(){return(se=Object(o.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("fetching path: ",t),e.next=3,window.fetch(t);case 3:return e.next=5,e.sent.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function le(){var e=Object(s.a)(["\n    * {\n        box-sizing: border-box;\n    }\n\n    html,\n    body {\n        margin: 0;\n        padding: 0;\n        height: 100%;\n        width: 100%;\n        user-select: none;\n        position: fixed;\n        overflow: hidden;\n    }\n"]);return le=function(){return e},e}var de=l.b.main.withConfig({displayName:"App__Container",componentId:"sc-1p3585w-0"})(["position:absolute;top:0;left:0;width:100vw;height:100%;background:#546a76;display:grid;grid-template-rows:minmax(50px,80px) auto minmax(50px,80px);"]),ue=Object(l.a)(le());t.a=function(e){var t=e.path,n=Object(d.useState)(null),a=Object(c.a)(n,2),r=a[0],s=a[1];return Object(d.useEffect)((function(){(function(){var e=Object(o.a)(i.a.mark((function e(){var n,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ie(t);case 2:(n=e.sent)?(a=ee.fromData(n),s(a)):console.warn("Scenario loading error");case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[t,s]),u.a.createElement(de,null,u.a.createElement(ue,null),r&&u.a.createElement(H,{scenario:r}))}},28:function(e,t,n){e.exports=n(29)},29:function(e,t,n){"use strict";n.r(t),function(e){var t,a,r=n(1),i=n.n(r),o=n(18),c=n.n(o),s=(n(34),n(27)),l=new URLSearchParams(window.location.search).get("path")||(null===(t=e)||void 0===t||null===(a=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_SFF_DEFAULT_SCENARIO:"/data/scenarios/default"}))||void 0===a?void 0:a.REACT_APP_SFF_DEFAULT_SCENARIO)||"/data/default";c.a.render(i.a.createElement(s.a,{path:l}),document.getElementById("root"))}.call(this,n(16))},34:function(e,t,n){}},[[28,1,2]]]);
//# sourceMappingURL=main.d3cf89eb.chunk.js.map