(this.webpackJsonpswipeforfuture=this.webpackJsonpswipeforfuture||[]).push([[0],{28:function(e,t,n){e.exports=n(38)},33:function(e,t,n){},35:function(e,t,n){},38:function(e,t,n){"use strict";n.r(t);var a,r=n(1),i=n.n(r),o=n(20),s=n.n(o),c=(n(33),n(3)),l=n.n(c),u=n(9),d=n(2),p=n(5),f=n(14),m=n(4),v=n(8),h=n(7),y=n(6),w=n(12),g=n(21);!function(e){e[e.Left=-1]="Left",e[e.Right=1]="Right"}(a||(a={}));var b=function(e,t){return"perspective(1500px) rotate3d(1, 0, 0, 30deg) rotate3d(0, 0, 1, ".concat(e,"deg) scale(").concat(t,")")},x=function(){return Math.min(200,window.innerWidth/2)},E=function(e){var t,n,o=e.i,s=e.cardData,c=e.onSwipe,l=e.layer,u=s.title,p=s.distance,m=s.text,v=s.image,h=Object(w.c)((function(){return Object(f.a)(Object(f.a)({},function(e){return{x:0,y:0,scale:1,rot:0,delay:100*e}}(o)),{},{from:{rot:0,scale:1,y:10,x:0}})})),y=Object(d.a)(h,2),E=y[0],O=y[1],j=Object(r.useState)({isGone:!1,currentKey:null}),k=Object(d.a)(j,1)[0],C=function(e){Object(d.a)(e.args,1)[0];var t=e.down,n=Object(d.a)(e.delta,1)[0],a=(e.distance,Object(d.a)(e.direction,1)[0],e.velocity),r=Math.abs(n)*window.devicePixelRatio>x(),i=Math.sign(n);t||!r||k.isGone||(k.isGone=!0,window.setTimeout((function(){c(s,i),k.currentKey=null}),200));var o=k.isGone,l=o?(200+window.innerWidth)*i:t?n:0;O({x:l,rot:n/100+(o?10*i*a:0),scale:t?1.1:1,delay:void 0,config:{friction:50,tension:t?800:o?200:500}})};t=["ArrowLeft","ArrowRight"],n=function(e,t){if(e&&!k.currentKey&&(k.currentKey=t),k.currentKey===t){var n="ArrowLeft"===t?a.Left:a.Right;C({down:e,delta:[n*(x()/window.devicePixelRatio+1),0],direction:[n,0],args:[0],distance:0,velocity:5})}},Object(r.useEffect)((function(){var e=function(e){t.includes(e.key)&&n(!0,e.key)},a=function(e){t.includes(e.key)&&n(!1,e.key)};return window.addEventListener("keydown",e),window.addEventListener("keyup",a),function(){window.removeEventListener("keydown",e),window.removeEventListener("keyup",a)}}));var S=Object(g.a)((function(e){k.currentKey||C(e)})),I=E.x,N=E.y,L=E.rot,W=E.scale;return i.a.createElement(w.a.div,{className:"card-container",key:o,style:{position:"absolute",transform:Object(w.b)([I,N],(function(e,t){return"translate3d(".concat(e,"px,").concat(t,"px,0)")})),zIndex:l}},i.a.createElement(w.a.div,Object.assign({className:"card card-front"},S(o),{style:{transform:Object(w.b)([L,W],b)}}),i.a.createElement("div",{className:"card-content"},i.a.createElement("div",{className:"card-image",style:{backgroundImage:"url("+(v||"")+")"}}),i.a.createElement("div",{className:"card-text"},p&&i.a.createElement("em",{className:"location"},p),i.a.createElement("h1",{className:"title"},u),i.a.createElement("p",{className:"text"},m)))))},O=function(e){var t=e.x,n=e.y,a=e.r,r=void 0===a?0:a,o=e.layer;return i.a.createElement("div",{className:"card-container",style:{position:"absolute",transform:"translate3d(".concat(t,"px, ").concat(n,"px, 0)"),transition:"transform 0.1s",zIndex:o}},i.a.createElement("div",{className:"card card-back",style:{transform:"perspective(1500px) rotate3d(1, 0, 0, 30deg) rotate3d(0, 0, 1, ".concat(r,"deg)"),transition:"transform 0.1s"}},i.a.createElement("div",{className:"card-content"})))};n(35);function j(e,t,n){return(t+e-n%t)%t}var k=function(e){var t=e.onSwipe,n=e.card,a=e.tick,r=void 0===a?0:a,o=Array.apply(null,Array(5)).map((function(e,t){return t}));return i.a.createElement("div",{className:"deck-root"},o.map((function(e,t,n){return i.a.createElement(O,{x:0,y:10+n[j(t,n.length,r)]*(50/n.length),key:t,r:1*Math.sin(2345*e),layer:n.length-j(t,n.length,r)})})),i.a.createElement(E,{i:0,key:n.id,cardData:n,onSwipe:t,layer:o.length+1}))},C=n(26),S=n(25),I=n(27),N=p.a.div.withConfig({displayName:"Bar__Container",componentId:"sc-1d2had3-0"})(["margin-top:10px;width:40px;height:8px;border-radius:4px;background:#546a76;"]),L=p.a.div.withConfig({displayName:"Bar__Value",componentId:"sc-1d2had3-1"})(["position:relative;top:1px;left:1px;height:6px;max-width:38px;border-radius:3px;"]);function W(e){return e<=30?"#dd7373":e<=70?"#e7e247":"#91c779"}var D=function(e){var t=e.value,n=void 0===t?100:t;return i.a.createElement(N,null,i.a.createElement(L,{style:{width:"".concat(n,"%"),backgroundColor:W(n)}}))},_=p.a.header.withConfig({displayName:"Stats__Container",componentId:"e1jx7a-0"})(["background:#f6fbf5;display:flex;flex-direction:row;justify-content:space-evenly;align-items:center;"]),A=p.a.div.withConfig({displayName:"Stats__Stat",componentId:"e1jx7a-1"})(["display:flex;justify-content:space-between;align-items:center;flex-direction:column;"]),M=p.a.div.withConfig({displayName:"Stats__Icon",componentId:"e1jx7a-2"})(["width:40px;height:40px;border-radius:50%;background:#91c779;display:flex;justify-content:center;align-items:center;"]),T=function(e){var t=e.stats;return i.a.createElement(_,null,t.map((function(e){var t=e.icon,n=e.icon,a=e.icon,r=S[t]||C[n]||I[a],o=e.iconSize||"80%",s=e.value;return i.a.createElement(A,{key:e.id},i.a.createElement(M,null,r&&i.a.createElement(r,{size:o})),i.a.createElement(D,{value:s}))})))},R=p.a.footer.withConfig({displayName:"Game__Footer",componentId:"kxsm7q-0"})(["display:flex;justify-content:center;align-items:center;"]);window.DEV_TOOLS_ACTIVE=window.location.hostname.includes("localhost"),window.DEV_TOOLS={};var V=function(e){Object(h.a)(n,e);var t=Object(y.a)(n);function n(){var e;Object(m.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).state=e.getInitialState(),e}return Object(v.a)(n,[{key:"render",value:function(){var e=this.addUniqueCardId(this.state.card),t=this.state.world.state,n=this.props.worldData.stats.map((function(e){return Object.assign({},e,{value:t[e.id]})}));return i.a.createElement(i.a.Fragment,null,i.a.createElement(T,{stats:n}),i.a.createElement(k,{onSwipe:this.onSwipe.bind(this),card:e,tick:this.state.rounds}),i.a.createElement(R,null,i.a.createElement("div",{className:"time-remaining"})))}},{key:"getInitialState",value:function(){var e=this.props.worldData.defaultState;return{world:e,card:this.getInitialCard(e),rounds:0}}},{key:"getInitialCard",value:function(e){var t=this.getAvailableEvents(e),n=this.selectNextEvent(t);return n?this.selectEventCard(n.initialEventCardId):this.selectNextCard(this.getAvailableCards(this.props.worldData.defaultState))}},{key:"getAvailableCards",value:function(e){var t=this;return this.props.worldData.cards.filter((function(n){return t.hasMatchingWorldQuery(e,n.isAvailableWhen)}))}},{key:"getAvailableEvents",value:function(e){var t=this;return this.props.worldData.events.filter((function(n){return t.hasMatchingWorldQuery(e,n.shouldTriggerWhen)}))}},{key:"hasMatchingWorldQuery",value:function(e,t){var n=this;return t.some((function(t){return n.isMatchingWorldQuery(e,t)}))}},{key:"isMatchingWorldQuery",value:function(e,t){var n=t.state,a=void 0===n?{}:n,r=t.flags,i=void 0===r?{}:r;return Object.entries(a).every((function(t){var n=Object(d.a)(t,2),a=n[0],r=Object(d.a)(n[1],2),i=r[0],o=r[1];return e.state[a]>=i&&e.state[a]<=o}))&&Object.entries(i).every((function(t){var n=Object(d.a)(t,2),a=n[0],r=n[1];return e.flags[a]===r}))}},{key:"onSwipe",value:function(e,t){var n=t===a.Left?e.actions.left:e.actions.right,r=this.getUpdatedWorld(n.modifier);this.setState({world:r,card:this.getNextCard(r,e,n),rounds:this.state.rounds+1})}},{key:"getNextCard",value:function(e,t,n){var a,r=this.props.worldData.eventCards,i=this.getAvailableEvents(e),o=[],s="event"===t.type&&"nextEventCardId"in n?n.nextEventCardId:null,c=s?null:this.selectNextEvent(i);if(s){if(!r.hasOwnProperty(s))throw new Error('eventCardId "'.concat(s,"\" does not exist. Make sure it's spelled correctly"));a=this.selectEventCard(s)}else c?a=this.selectEventCard(c.initialEventCardId):(o=this.getAvailableCards(e),a=this.selectNextCard(o));if(window.DEV_TOOLS_ACTIVE&&(window.DEV_TOOLS.availableCards=o,window.DEV_TOOLS.availableEvents=i,window.DEV_TOOLS.nextCard=a,console.log("DEV TOOLS: ",window.DEV_TOOLS)),!a)throw new Error("Content error. No next card available.");return a}},{key:"getUpdatedWorld",value:function(e){var t=e.type,n=void 0===t?"add":t,a=e.state,r=void 0===a?{}:a,i=e.flags,o={type:n,state:r,flags:void 0===i?{}:i};return{state:this.updateWorldState(o),flags:this.updateWorldFlags(o)}}},{key:"updateWorldState",value:function(e){var t="replace"===e.type?Object.assign({},this.props.worldData.defaultState.state):Object.assign({},this.state.world.state),n=e.state||{};return Object.entries(n).reduce((function(t,n){var a=Object(d.a)(n,2),r=a[0],i=a[1],o="set"===e.type||"replace"===e.type?i:i+(t[r]||0);return t[r]=Math.min(Math.max(o,0),100),t}),t)}},{key:"updateWorldFlags",value:function(e){var t="replace"===e.type?Object.assign({},this.props.worldData.defaultState.flags):Object.assign({},this.state.world.flags),n=e.flags||{};return Object.entries(n).reduce((function(e,t){var n=Object(d.a)(t,2),a=n[0],r=n[1];return e[a]=r,e}),t)}},{key:"addUniqueCardId",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Object(f.a)(Object(f.a)({},e),{},{id:Date.now()+":"+t})}},{key:"selectNextCard",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.selectWeightedRandomFrom(e)}},{key:"selectNextEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=this.selectRandomFrom(e);if(t&&Math.random()<=t.probability)return t}},{key:"selectRandomFrom",value:function(e){return e[Math.floor(Math.random()*e.length)]}},{key:"selectWeightedRandomFrom",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return e.weight},n=e.reduce((function(e,n){return e.count+=t(n),e.selectionList.push(e.count),e}),{count:0,selectionList:[]}),a=n.selectionList,r=n.count,i=Math.random()*r,o=a.findIndex((function(e,t,n){var a=t>0?n[t-1]:0;return i>=a&&i<=e}));return e[o]}},{key:"selectEventCard",value:function(e){var t=this.props.worldData.eventCards[e];if(!t)throw new Error('ContentError: EventCard with EventCardId "'.concat(e,'" does not exist'));return t}}]),n}(r.Component),P=Object.freeze({state:{environment:40,people:60,security:75,money:90},flags:{}}),F=[{id:"environment",name:"Environment",icon:"GiWheat"},{id:"people",name:"People",icon:"IoIosPeople"},{id:"security",name:"Security",icon:"GiAk47"},{id:"money",name:"Money",icon:"GiMoneyStack"}],G={stats:F,cards:[{type:"card",image:"https://images.unsplash.com/photo-1561623002-b3520705eccf?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=800&q=60",title:"We need power.",distance:"4 miles away",text:"Lorem ipsum COALar sit amet consectetur, adipisicing elit.",weight:1,isAvailableWhen:[{state:{environment:[10,100],money:[80,100]}},{state:{people:[10,100],money:[80,100]}},{state:{security:[10,100],money:[80,100]}}],actions:{left:{modifier:{type:"add",state:{environment:-100,people:-100,security:-100,money:-100}}},right:{modifier:{type:"add",state:{environment:40,people:60,security:75,money:90}}}}},{type:"card",image:"https://images.unsplash.com/photo-1497435334941-8c899ee9e8e9?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=800&q=60",title:"Invest in solar?",distance:"100 miles away",text:"Lorem ipsum SOLAR sit amet consectetur, adipisicing elit.",weight:1,isAvailableWhen:[{state:{environment:[60,100],money:[30,31]}},{state:{people:[60,100],money:[30,31]}},{state:{security:[60,100],money:[30,31]}}],actions:{left:{modifier:{type:"add",state:{environment:-100,people:-100,security:-100,money:-100}}},right:{modifier:{type:"add",state:{environment:40,people:60,security:75,money:90}}}}}],events:[{probability:1,shouldTriggerWhen:[{state:{environment:[0,0]}},{state:{security:[0,0]}},{state:{money:[0,0]}},{state:{people:[0,0]}}],initialEventCardId:"end-game"}],eventCards:{"end-game":{type:"event",image:"https://images.unsplash.com/photo-1497039465987-61d305728610?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=800&q=60",title:"The World Has Ended.",distance:"100 miles away",text:"Please find a new planet to destroy, if you want to proceed. And do not try to swipe. Please.",weight:1e3,actions:{left:{modifier:{type:"replace",state:{environment:10,people:10,security:10},flags:{}},nextEventCardId:null},right:{modifier:{type:"replace",state:{environment:10,people:10,security:10},flags:{}},nextEventCardId:null}}}},defaultState:P},Q={default:G};function q(e){return B.apply(this,arguments)}function B(){return(B=Object(u.a)(l.a.mark((function e(t){var n,a,r,i,o,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=t.match(/^local:\/\/(.*)/))){e.next=17;break}if(a=n[1],r="game_world:"+a,i={},e.prev=5,o=localStorage.getItem(r),s=o?JSON.parse(o):null){e.next=10;break}throw new Error("Could not load data from local storage: "+r);case 10:i=s||{},e.next=16;break;case 13:e.prev=13,e.t0=e.catch(5),console.log(e.t0);case 16:return e.abrupt("return",Object.assign({},G,i));case 17:return e.abrupt("return",null);case 18:case"end":return e.stop()}}),e,null,[[5,13]])})))).apply(this,arguments)}function J(e){return K.apply(this,arguments)}function K(){return(K=Object(u.a)(l.a.mark((function e(t){var n,a,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=t.match(/^internal:\/\/(.*)/))){e.next=8;break}if(a=n[1],r=Q[a]){e.next=7;break}return console.warn("Could not load local game world: ",a),e.abrupt("return",G);case 7:return e.abrupt("return",r);case 8:return e.abrupt("return",null);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(e){return U.apply(this,arguments)}function U(){return(U=Object(u.a)(l.a.mark((function e(t){var n,a,r,i,o,s,c,u,p,f,m,v;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t+"/stats.json",a=t+"/cards.json",r=t+"/events.json",i=t+"/event-cards.json",o=t+"/default-state.json",e.t0=Promise,e.next=8,Y(n,F);case 8:return e.t1=e.sent,e.next=11,Y(a,[]);case 11:return e.t2=e.sent,e.next=14,Y(r,[]);case 14:return e.t3=e.sent,e.next=17,Y(i,{});case 17:return e.t4=e.sent,e.next=20,Y(o,P);case 20:return e.t5=e.sent,e.t6=[e.t1,e.t2,e.t3,e.t4,e.t5],e.next=24,e.t0.all.call(e.t0,e.t6);case 24:return s=e.sent,c=Object(d.a)(s,5),u=c[0],p=c[1],f=c[2],m=c[3],v=c[4],e.abrupt("return",{stats:u,cards:p,events:f,eventCards:m,defaultState:v});case 32:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(e){return X.apply(this,arguments)}function X(){return(X=Object(u.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,J(t);case 2:if(e.t1=e.sent,e.t1){e.next=7;break}return e.next=6,q(t);case 6:e.t1=e.sent;case 7:if(e.t0=e.t1,e.t0){e.next=12;break}return e.next=11,z(t);case 11:e.t0=e.sent;case 12:return e.abrupt("return",e.t0);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Y(e,t){return Z.apply(this,arguments)}function Z(){return(Z=Object(u.a)(l.a.mark((function e(t,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("fetching path: ",t),e.next=4,window.fetch(t);case 4:return e.next=6,e.sent.json();case 6:return e.abrupt("return",e.sent);case 9:return e.prev=9,e.t0=e.catch(0),console.warn("Could not load path: "+t),e.abrupt("return",n);case 13:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}var $=p.a.main.withConfig({displayName:"App__Container",componentId:"sc-1p3585w-0"})(["position:absolute;top:0;left:0;width:100vw;height:100%;background:#546a76;display:grid;grid-template-rows:minmax(50px,80px) auto minmax(50px,80px);"]);var ee=function(e){var t=e.path,n=Object(r.useState)(null),a=Object(d.a)(n,2),o=a[0],s=a[1];return Object(r.useEffect)((function(){(function(){var e=Object(u.a)(l.a.mark((function e(){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,H(t);case 2:n=e.sent,s(n);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[t,s]),i.a.createElement($,null,o&&i.a.createElement(V,{worldData:o}))},te=new URLSearchParams(window.location.search).get("path")||"/data/default";s.a.render(i.a.createElement(ee,{path:te}),document.getElementById("root"))}},[[28,1,2]]]);
//# sourceMappingURL=main.67eaa33c.chunk.js.map